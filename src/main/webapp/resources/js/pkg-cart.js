define("pages/pay/cart/js/undo",[],function(){var t=$(".J_mundo").eq(0),e=t.find(".J_num"),a=$("#cartSlide"),n=$("#cartPaybar"),i=$("#cartPage"),r=0,o=0,c=0,s=function(){t.on("click",".J_undo",function(){var e=$(".s-undo");e.show().removeClass("s-undo"),e.each(function(t,e){var a=$(e);a.find("td").each(function(t,e){var a=$(e),n=a.find(">div");a.append(n.children()).removeClass("animate-td-hide"),n.remove()}),a.hasClass("cart_mitem")&&i.trigger("cart:undo",[a.attr("data-stockid"),a.find(".cart_num_input").val()])}),a.trigger("update",[[-r,-o,-c]]),t.hide(),n.trigger("change:price")})};return $(document).ready(function(){s()}),{show:function(a,n,i){isNaN(a)||isNaN(n)||isNaN(i)||(this.reset(),r=+a,o=+n,c=+i,e.html(r),t.show())},reset:function(){r=0,o=0,c=0,$(".s-undo").remove(),t.hide()}}}),define("widgets/mtip/index",[],function(){function t(t,e,a){this.message=t,this.targetEl=e,this.settings=$.extend({offsetX:0,offsetY:0,angMethod:"default",angOffset:0,angSpace:7,zIndex:"auto",tipWidth:-1,maxTipWidth:365,direction:"auto",hover:!1,closeBtn:!0},a)}return window.MOGU=MOGU||{},t.prototype.getPositionInfo=function(){var t,e,a={},n=0,i=this._$tip,r=this.targetEl;switch(e=r.offset(),a.targetX=e.left,a.targetY=e.top,a.targetWidth=r.outerWidth(),a.targetHeight=r.outerHeight(),t=i.outerWidth()-i.width(),this.settings.tipWidth>0?i.css("width",this.settings.tipWidth-t):i.outerWidth()>=this.settings.maxTipWidth?i.css("width",this.settings.maxTipWidth-t):i.css("width","auto"),a.tipWidth=i.outerWidth(),a.tipHeight=i.outerHeight(),a.angSpace=this.settings.angSpace,a.angDirection=this.settings.direction,a.angOffset=this.settings.angOffset,a.offsetX=this.settings.offsetX,a.offsetY=this.settings.offsetY,"auto"===a.angDirection&&(a.angDirection=a.targetY-$(window).scrollTop()>=a.tipHeight+a.angSpace-a.offsetY?"top":$(window).scrollTop()+document.body.clientHeight-a.targetY-a.targetHeight>=a.tipHeight+a.angSpace+a.offsetY?"bottom":a.targetX>a.tipWidth+a.angSpace-a.offsetX?"left":document.body.clientWidth-a.targetX-a.targetWidth>=a.tipWidth+a.angSpace+a.offsetX?"right":"top"),a.tipHolderX=0,a.tipHolderY=0,a.angDirection){case"top":a.tipHolderY=-(a.tipHeight+a.angSpace);break;case"bottom":a.tipHolderY=a.targetHeight+a.angSpace;break;case"left":a.tipHolderX=-(a.tipWidth+a.angSpace);break;case"right":a.tipHolderX=a.targetWidth+a.angSpace}if(a.angMethod=this.settings.angMethod,"none"===a.angMethod)a.angStyle={display:"none"};else switch("center"===a.angMethod&&(("top"===a.angDirection||"bottom"===a.angDirection)&&(n=a.tipWidth/2-a.angSpace),("left"===a.angDirection||"right"===a.angDirection)&&(n=a.tipHeight/2-a.angSpace)),a.angDirection){case"top":a.angStyle={display:"block",bottom:0,top:"auto"},a.angOffset>=0?(a.angStyle.left=a.angOffset+n,a.angStyle.right="auto"):(a.angStyle.left="auto",a.angStyle.right=-a.angOffset+n),a.angHolderX=n,a.angHolderY=0;break;case"bottom":a.angStyle={display:"block",top:0,bottom:"auto"},a.angOffset>=0?(a.angStyle.left=a.angOffset+n,a.angStyle.right="auto"):(a.angStyle.left="auto",a.angStyle.right=-a.angOffset+n),a.angHolderX=n,a.angHolderY=0;break;case"left":a.angStyle={display:"block",right:0,left:"auto"},a.angOffset>=0?(a.angStyle.top=a.angOffset+n,a.angStyle.bottom="auto"):(a.angStyle.top="auto",a.angStyle.bottom=-a.angOffset+n),a.angHolderX=0,a.angHolderY=n;break;case"right":a.angStyle={display:"block",left:0,right:"auto"},a.angOffset>=0?(a.angStyle.top=a.angOffset+n,a.angStyle.bottom="auto"):(a.angStyle.top="auto",a.angStyle.bottom=-a.angOffset+n),a.angHolderX=0,a.angHolderY=n}return a.zIndex=this.settings.zIndex,a},t.prototype.show=function(){var t=this._$tip,e=(this.targetEl,this.getPositionInfo());t.removeClass("mtip_top").removeClass("mtip_left").removeClass("mtip_right").removeClass("mtip_bottom").addClass("mtip_"+e.angDirection),t.css({left:e.targetX+e.tipHolderX+e.offsetX-e.angHolderX,top:e.targetY+e.tipHolderY+e.offsetY-e.angHolderY,"z-index":e.zIndex}),t.find(".widget_mtip_a").css(e.angStyle)},t.prototype.render=function(){$("body").append(this._$tip)},t.prototype.bind=function(){var t=this,e=t._$tip,a=t.settings,n=t.targetEl;e.off("click",".widget_mtip_close"),n.off("mouseenter.mtip").off("mouseleave.mtip"),a.closeBtn?e.on("click",".widget_mtip_close",function(){t.close()}):e.find(".widget_mtip_close").hide(),a.hover&&(n.on("mouseenter.mtip",function(){clearTimeout(t.hover_t),t.hover_t=setTimeout(function(){e.show(),t.show()},100)}).on("mouseleave.mtip",function(){clearTimeout(t.hover_t),t.close()}),t.close())},t.prototype.close=function(){this._$tip.hide()},t.prototype.getDom=function(t){var e=$(['<div class="widget_mtip_box">','<div class="widget_mtip_line">'+t+"</div>",'<i class="widget_mtip_ang widget_mtip_a"></i>','<i class="widget_mtip_shadow widget_mtip_a"></i>','<a href="javascript:;" class="widget_mtip_close">×</a>',"</div>"].join(""));return e},MOGU.mtip=function(e,a,n){if(!(a.length<=0)){var i=a.data("mtipObj");return i?(i.message=e,i.settings=$.extend(i.settings,n),i._$tip.find(".widget_mtip_line").html(i.message),i._$tip.show()):(i=new t(e,a,n),a.data("mtipObj",i),i._$tip=i.getDom(i.message),i.render()),i.show(),i.bind(),i}},MOGU.mtip}),define("pages/pay/common/js/common",[],function(){return window.webapp=window.webapp||{},webapp.cartCommon=function(t){var e=function(t){return t.substr(0,t.indexOf("_100x100"))+"_280x999.jpg"},a=function(){function e(e,a){var n=this;n.min=1,n.max=+e.attr("data-stocknum"),n.max<n.min&&(n.max=n.min),n.$dom=e,n.$input=e.find(".cart_num_input").eq(0),n.$increase=e.find(".cart_num_add").eq(0),n.$reduce=e.find(".cart_num_reduce").eq(0),n.$cartPaybar=t("#cartPaybar"),n.$disScreen=a,n.stockid=e.attr("data-stockid"),n.num=n.$input.length>0?+n.$input.val():0,n.unit=+a.attr("data-unit"),n.updatePrice(!0),n.num>=n.max&&n.$increase.addClass("disable"),n.num<=1&&n.$reduce.addClass("disable"),n.$increase.on("click",function(){n.judgeNum(n.num+1)}),n.$reduce.on("click",function(){n.judgeNum(n.num-1)}),n.$input.on("blur",function(){var e=t(this),a=e.val();isNaN(a)?n.$input.val(n.num):n.judgeNum(+a)})}e.prototype.judgeNum=function(t){var e=this;(t>e.max||t<e.min)&&e.$input.val(e.num),t>e.num&&t<=e.max&&(!(t<e.max)&&e.$increase.addClass("disable"),e.$reduce.removeClass("disable"),e.$input.val(t),e.num=t,e.updatePrice()),t<e.num&&t>=e.min&&(!(t>e.min)&&e.$reduce.addClass("disable"),e.$increase.removeClass("disable"),e.$input.val(t),e.num=t,e.updatePrice())},e.prototype.updatePrice=function(t){var e=this;e.price=(e.num*e.unit).toFixed(2),e.$disScreen.html(e.price),e.$disScreen.attr("data-price",e.price),e.$cartPaybar.trigger("change:price"),t||e.$dom.trigger("post:change",[e.stockid,e.num])},t(".cart_counter").each(function(){var a=t(this),n=a.parent().next().find(".item_sum").eq(0);new e(a,n)})},n=function(){var a=t(".cartImgTip"),n=['<div class="cart_imgtip_wrap">','<img src="{{=it.src}}" width="240" />',"</div>"].join("");a.each(function(){var a=t(this),i=MoGu.ui.getdoT(),r=i.template(n)({src:e(a.attr("src"))});MOGU.mtip(r,a,{hover:!0,offsetY:-32,angOffset:42,closeBtn:!1,direction:"right"})})},i=function(){var e=t("#cartPaybar:visible"),a=t("#cartOrderTable"),n=e.find(".goodsSum"),i=e.find(".goodsNum"),r=t(window),o=t(".cart_wrap").eq(0),c=e.outerHeight(),s="cart_paybar_fixed";e.length<=0||(e.on("change:price",function(){var r=a.find(".cart_mitem").filter(":not(.s-undo)").find(".cart_thcheck").filter(".checked"),o=0,c=r.length;r.each(function(){var e,a,n,i,r,c=t(this).parent().parent();e=c.attr("data-bid"),a=c.attr("data-stockid"),n=+c.find(".cart_num_input").eq(0).val(),i=+c.find(".cart_data_sprice").attr("data-price"),r=+c.find(".item_sum").attr("data-price"),o+=r}),i.html(c),n.html("¥ "+o.toFixed(2)),0>=c?e.find(".cart_paybtn").addClass("cart_paybtn_disable"):e.find(".cart_paybtn").removeClass("cart_paybtn_disable")}).trigger("change:price"),r.on("scroll.paybar",function(){var t=document.body.scrollTop||document.documentElement.scrollTop||window.pageYOffset||0,a=window.innerHeight||document.documentElement.clientHeight,n=o.offset().top+o.outerHeight()+c-a;t>n?e.removeClass(s):e.addClass(s)}).trigger("scroll.paybar"))},r=function(){t(".cart_hidetip").each(function(){var e=t(this),a=e.next().html();MOGU.mtip(a,e,{hover:!0,angOffset:-20,closeBtn:!1,direction:"bottom"})})},o=function(){var e=t(".cart_table_note");MOGU.Globe_Input_Text_Hide(e),e.trigger("blur")};return{init:function(){n(),r(),o()},initPayBar:function(){i()},initCounter:function(){a()}}}(jQuery),$(document).ready(function(){webapp.cartCommon.init()}),webapp.cartCommon}),define("pages/pay/common/js/browser",[],function(){var t,e,a=$("#J_browserGoods"),n=a.attr("data-param");if(!(a.length<=0)&&n){t=$.parseJSON(n),t.f="json",e=$("#tpl_browser_goods").html();var i=function(t){for(var e in t)return!1;return!0};$.ajax({url:"/widget/trade/recommend/product",data:t,dataType:"json",success:function(t){if(t&&t.status&&1001===t.status.code){var n=t.result;n.cdnHost=window.MOGUPROFILE&&MOGUPROFILE.cdnHost?MOGUPROFILE.cdnHost:"http://s6.mogucdn.com",n.isArrRecentlyBrowserEmpty=i(n.arrRecentlyBrowser),n.isArrRecentlyBrowserEmpty||a.html(MoGu.ui.getTemplate(e,n))}}})}}),require(["pages/pay/cart/js/undo","widgets/mtip/index","pages/pay/common/js/common","pages/pay/common/js/browser"],function(t){window.MOGUPROFILE=window.MOGUPROFILE||{},window.webapp=window.webapp||{},webapp.cart=function(e){var a=e("#cartPage"),n=e("#cartEmptyPage"),i=e("#cartOrderTable"),r=e("#cartPaybar"),o=e(".s_all"),c=e(".s_all_slave"),s=e(".s_shopall"),d=e("#cartRemoveChecked"),l=e("#cartRemoveUnuse"),u=e("#cartSlide"),p=e("#postform"),f=e("#postdata"),h=e("#traceid"),g=e(".J_mundo"),m=(e("#data_props"),e("#shop_domain"),e("#traceid"),300),v=function(){e(".cart_group_head").length<=0&&(e(".cart_wrap").eq(0).removeClass("cart_nobdbtm"),a.slideUp(m),n.slideDown(m),r.fadeOut(m))},_=function(t){function a(){n||(n=!0,v(t))}var n=!1,r=i.find("tr[data-bid="+t+"]").filter(":not(.s-undo)");if(r.length<=1){var o=e("#shoptit_"+t);o.find("td").wrapInner('<div style="display: block;" />').parent().find("td > div").slideUp(m,function(){o.addClass("s-undo"),o.hide(),a()}),o.find("td").addClass("animate-td-hide")}},b=function(t){function a(){d||(d=!0,u.trigger("update",[s]),_(n),r.trigger("change:price"))}t.eq(0).after(g);var n=t.attr("data-bid"),i=t.attr("data-stockid"),o=t.attr("data-cut"),c=t.attr("data-stock"),s=[],d=!1,l=e(window),p=t.find("td").wrapInner('<div style="display: block;" />').parent().find("td > div");s[0]=1,s[1]="true"===o?1:0,s[2]="true"===c?1:0,MOGUPROFILE.userid&&(C(i),O(i)),p.animate({opacity:0},m/2,function(){p.slideUp(m/2,function(){t.hide(),MOGUPROFILE.userid||(C(i),O(i)),l.trigger("scroll.paybar"),a()}),t.find("td").addClass("animate-td-hide")})},w=function(t){var e=t.join(",");","===e&&(e=""),MGTOOL.setCookie("mogu_trade_cart",e,{expires:15,path:"/"})},k=function(t,a){MOGUPROFILE.userid?e.ajax({url:"/trade/cart/changeNumber",data:{stockId:t,num:a},type:"POST",dataType:"json",success:function(){}}):w(S())},y=function(t,a){MOGUPROFILE.userid?e.ajax({url:"/trade/cart/add2cart2",data:{stockId:t,number:a,traceid:h.val(),from:"ajax"},type:"GET",success:function(){}}):w(S())},C=function(t){MOGUPROFILE.userid?e.ajax({url:"/trade/cart/delete",data:{stockid:t,traceid:h.val()},type:"POST",dataType:"json",success:function(){}}):w(S())},O=function(t){if(window.log_stat_url_tmp){t=t||0;var e=[log_stat_url_tmp,"&refer=http://www.mogujie.com/trade/cart/delete?stockId=",t,"&rerefer=",log_stat_rerefer,"&anchor=",log_stat_anchor].join(""),a=new Image;a.src=e}},$=function(){var t=[];return i.find("tr.selected").filter(":not(.s-undo)").each(function(){var a=e(this),n=a.find(".cart_thcheck").eq(0);if("checked"===n.attr("checked")){var i=a.find(".cart_counter").eq(0);t.push(i.attr("data-stockid")),t.push(i.find(".cart_num_input").eq(0).val()+"#"+i.attr("data-timestamp"))}}),t},S=function(){var t,a,n,i=[];return e(".cart_mitem").filter(":not(.s-undo)").each(function(){var r=e(this);t=r.attr("data-stockid"),n=r.attr("data-timestamp"),a=r.find(".cart_num_input").eq(0).val(),i.push(t),i.push(a+"#"+n)}),i},x=function(){var t=u.find(".num").eq(0),e=u.find(".num").eq(1),a=u.find(".num").eq(2),n=[t,e,a],i=u.find("a").index(u.find(".cart_slide_item_cur").eq(0)),r=[+t.html(),+e.html(),+a.html()],o=!1;u.on("update",function(t,e){"[object Array]"===Object.prototype.toString.call(e)&&3===e.length&&!function a(t){if(o)setTimeout(function(){a(t)},50);else{o=!0;var e,c;for(e=0,c=r.length;c>e;e++)r[e]-=t[e],r[e]<0&&(r[e]=0),n[e].html(r[e]);r[i]<=0&&location.reload(),o=!1}}(e)})},H=function(){e("input[type=checkbox]").each(function(){var t=e(this);"checked"===t.attr("checked")&&t.addClass("checked")})},j=function(){a.on("cart:undo",function(t,e,a){y(e,a)}),s.each(function(){var t=e(this),a=t.attr("data-bid"),n=i.find("tr[data-bid="+a+"]").find(".cart_thcheck");n.on("change:data",function(){var t=e(this),n=s.filter("[data-bid="+a+"]");n.hasClass("checked")?(t.addClass("checked").attr("checked","checked"),t.parent().parent().addClass("selected")):(t.removeClass("checked").removeAttr("checked"),t.parent().parent().removeClass("selected")),r.trigger("change:price")}).on("click",function(){var t=e(this);t.hasClass("checked")?(t.removeClass("checked"),s.filter("[data-bid="+a+"]").removeClass("checked").removeAttr("checked"),o.removeClass("checked").removeAttr("checked"),c.removeClass("checked").removeAttr("checked"),t.parent().parent().removeClass("selected")):(t.addClass("checked"),t.parent().parent().addClass("selected")),r.trigger("change:price")})}),s.on("click",function(){var t=e(this),a=t.attr("data-bid");t.toggleClass("checked"),i.find("tr[data-bid="+a+"]").find(".cart_thcheck").trigger("change:data"),t.hasClass("checked")||(o.removeClass("checked").removeAttr("checked"),c.removeClass("checked").removeAttr("checked"))}),s.on("change:data",function(){var t=e(this);(o.eq(0).hasClass("checked")&&!t.hasClass("checked")||!o.eq(0).hasClass("checked")&&t.hasClass("checked"))&&t.trigger("click")}),c.on("click",function(){e(this).toggleClass("checked"),o.eq(0).trigger("change:data")}).on("change:data",function(){var t=e(this);o.eq(0).hasClass("checked")?t.addClass("checked").attr("checked","checked"):t.removeClass("checked").removeAttr("checked")}),o.on("click",function(){e(this).toggleClass("checked"),c.trigger("change:data"),s.trigger("change:data")}).on("change:data",function(){var t=e(this);t.hasClass("checked")?(t.removeClass("checked"),t.removeAttr("checked")):(t.addClass("checked"),t.attr("checked","checked")),s.trigger("change:data")}),i.on("click",".delete",function(a){a.preventDefault();var n=e(this),i=n.parent().parent(),r=webapp.util.calcItemNumProp(i);t.show(r[0],r[1],r[2]),i.addClass("s-undo"),b(i)}),l.on("click",function(){var a=i.find(".outline").filter(":not(.s-undo)");if(a.length<=0)MOGU.alert("没有失效的商品");else{var n=webapp.util.calcItemNumProp(a);t.show(n[0],n[1],n[2]),a.each(function(){var t=e(this);t.addClass("s-undo"),b(t)})}}),d.on("click",function(){var a,n;o.eq(0).hasClass("checked")?a=i.find(".cart_mitem").filter(":not(.s-undo)"):(n=i.find(".outline").filter(function(){var t=e(this).attr("data-bid"),a=e("#shoptit_"+t).find(".s_shopall").eq(0).hasClass("checked");return a}),a=i.find(".selected").filter(":not(.s-undo)").add(n.filter(":not(.s-undo)"))),a.length<=0?MOGU.alert("没有选中任何商品"):MOGU.confirm("确定删除选中商品",function(n){if(n){var i=webapp.util.calcItemNumProp(a);t.show(i[0],i[1],i[2]),a.each(function(){var t=e(this);t.addClass("s-undo"),b(t)})}})}),r.find(".cart_paybtn").on("click",function(t){t.preventDefault();var a=e(this);if(a.hasClass("cart_paybtn_disable")){var n=MOGU.mtip("请勾选您想购买的商品",a,{angOffset:12,closeBtn:!1,direction:"top"});return r.on("mouseleave",function(){n.close(),r.off("mouseleave")}),!1}}),e(".cart_counter").on("post:change",function(t,e,a){t.preventDefault(),k(e,a)}),e("#payBtn").on("click",function(t){if(t.preventDefault(),!e(this).hasClass("cart_paybtn_disable")){var a,n=e(this);n.hasClass("disable")||n.hasClass("cart_paybtn_disable")||(n.addClass("disable"),a=$(),a.join(","),f.val(a),p.submit(),setTimeout(function(){n.removeClass("disable")},1e3))}})};return{init:function(){H(),j(),x(),webapp.cartCommon.initCounter(),webapp.cartCommon.initPayBar()}}}(jQuery),webapp.util=function(t){var e=function(t,e,a){var n,i,r,o,c,s,d=[];o=t.indexOf("?"),o>=0?(n=t.substr(0,o),s=t.substr(o+1),c=s.indexOf("#"),c>=0?(r=s.substr(0,c),i=s.substr(c+1)):(r=s,i=""),d=r.split("&")):(n=t,r="",i=""),d.push(e+"="+encodeURIComponent(a));var l=n;return d.length>0&&(l+="?"+d.join("&")),""!==i&&(l+="#"+i),l},a=function(e){var a=0,n=0,i=0;return e.each(function(e,r){var o=t(r);o.hasClass("cart_mitem")&&(a++,"true"===o.attr("data-cut")&&n++,"true"===o.attr("data-stock")&&i++)}),[a,n,i]};return{addParam2QS:function(t,a,n){return e(t,a,n)},calcItemNumProp:function(t){return!t||t.length<=0?[0,0,0]:a(t)}}}(jQuery),$(document).ready(function(){webapp.cart.init()})});