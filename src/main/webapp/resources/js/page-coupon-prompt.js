!function(e){MOGU.User_Setting_Avartar=function(){if(0!=e("#avartarForm").size()){var t="",i='<img src="{avatar_url}_100x100.{ext}" class="head_bd round" alt=""><img src="{avatar_url}_64x64.{ext}" class="head_bd round" alt=""><img src="{avatar_url}_48x48.{ext}" class="head_bd round" alt=""><img src="{avatar_url}_32x32.{ext}" class="head_bd round" alt=""><img src="{avatar_url}_24x24.{ext}" class="head_bd round" alt="">';e("#uploadAvartar").bind("change",function(){setTimeout(function(){e("#setting_form .pink_alert_l").remove(),e("#setting_form .green_alert_l").remove(),e("#avartarForm dt.msg").html("<span>正在上传，请稍后……</span>").show(),"www.mogujie.com"!=location.hostname?e("#avartarForm").append('<input type="hidden" value="'+location.host+'" name="host">'):e("#avartarForm").attr("action","http://upload.mogujie.com/upload/addpic"),e("#avartarForm").append('<input type="hidden" value="avartar_upload_success" name="callback">'),0==e("#ifr_picup").size()&&e("body").append('<div style="display: none;"><iframe frameborder="0" name="ifr_picup" id="ifr_picup" src="about:blank"></iframe></div>'),e("#avartarForm").attr("target","ifr_picup"),e("#avartarForm").submit();var a=0,s=setInterval(function(){60==a&&(e("#ifr_picup").parent().remove(),alert(MGLANG.msgTimeout),clearInterval(s)),a++},1e3);window.avartar_upload_success=function(a,o,n,r){return clearInterval(s),1001!=a?void alert(o):(e("#avartarForm input[name='host']").remove(),e("#avartarForm input[name='callback']").remove(),t=n,e("#avartarForm .msg").hide(),e("#avartarForm dt.preview").html(i.replace(/{avatar_url}/g,r).replace(/{ext}/g,MGTOOL.getPicExtension(r))),e("#avartarForm .preview").show(),void e("#avartarForm .avartar_confirm").show())}},0)}),e("#avartarForm .avartar_confirm .green_button").click(function(){e.ajax({url:"/settings/avatar",type:"POST",timeout:6e4,data:{imgid:t},dataType:"json",success:function(t){if(null==t)alert(MGLANG.msgTimeout);else{var i=t.status.code,a=t.status.msg,s=t.result.data.path,o=MGTOOL.getPicExtension(s);if(1001==i){e("#avartarForm dt.msg").html("建议使用正方形的图片，支持JPG、GIF、JPG格式，100K以内。"),e("#avartarForm .msg").show(),e("#avartarForm .preview").hide(),e("#avartarForm dt.preview").html(""),e("#avartarForm .avartar_confirm").hide(),e("#avartarForm .head_bd").attr("src",s+"_100x100."+o),e("#avartarForm input[name='imgid']").val(""),e("#setting_form").prepend('<div class="green_alert_l">头像修改成功</div>');var n=location.href.toString(),r=MGTOOL.getRequest("ism",n);if(1==r){var c=e("#refer").val();c+="#moli_pop_id",MGTOOL.empty(c)||(window.location.href=c)}}else alert(a)}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)}})})}},MOGU.User_Setting_Base_Init=function(){if(0!=e("#setting_form.setting_basic").size()){var t=e("#setting_form.setting_basic input[name='company']"),i="帮助您找到同事或同学",a=e("#setting_form.setting_basic input[name='community']"),s="帮助您找到周围的邻居",o=e("#setting_form.setting_basic textarea"),n="随便写点什么，让大家了解你吧。",r=e("#user_style"),c="多个标签之间请用逗号隔开";t.val()!=i&&t.css("color","#000"),a.val()!=s&&a.css("color","#000"),o.val()!=n&&o.css("color","#666"),MOGU.Globe_Input_Text(t,i),MOGU.Globe_Input_Text(a,s),MOGU.Globe_Input_Text(o,n),MOGU.Globe_Input_Text(e("input[name=bwhB]"),"胸围"),MOGU.Globe_Input_Text(e("input[name=bwhW]"),"腰围"),MOGU.Globe_Input_Text(e("input[name=bwhH]"),"臀围"),e("#setting_form.setting_basic .green_button").click(function(){t.val()==i&&t.val(""),a.val()==s&&a.val(""),o.val()==n&&o.val(""),r.val()==c&&r.val(""),e("#setting_form.setting_basic form").submit()}),e(".unick [name=unick]").blur(function(){var t=e(this).val(),i=t.match(/1[3|5|7|8|][0-9]{9}/g);if(i&&i.length>0){var a="<span>为保证账号安全，请勿使用手机号码作为昵称</span>";e(".unick .iner").html(a)}else e(".unick .iner").html("<span>*</span>昵称只能修改一次哦^_^")})}},MOGU.User_Setting_Person_Style=function(){MOGU.Globe_Input_Text(e("#user_style"),"多个标签之间请用逗号隔开");var t=function(){e("body").bind("click",function(t){var i=(t.currentTarget,t||window.event),a=i.target||i.srcElement;MGTOOL.isParent(a,e(".fashion_list")[0])||(e(".fashion_list").hide(),e("body").unbind("click"))})};e("#user_style").focus(function(){e(".fashion_list").show(),e("body").unbind("click")}).blur(t),e(".fashion_list .tag a").click(function(){var t=e("#user_style"),i=MGTOOL.trim(t.val());"多个标签之间请用逗号隔开"==i&&(i=""),i=""!=i?i+","+e(this).text():e(this).text(),t.val(i)}),e(".fashion_list .close").click(function(){e(".fashion_list").hide()})},MOGU.Xingzuo_Pipei=function(){var t=function(e,t){return 1==e&&t>=20||2==e&&18>=t?1:2==e&&t>=19||3==e&&20>=t?2:3==e&&t>=21||4==e&&19>=t?3:4==e&&t>=20||5==e&&20>=t?4:5==e&&t>=21||6==e&&21>=t?5:6==e&&t>=22||7==e&&22>=t?6:7==e&&t>=23||8==e&&22>=t?7:8==e&&t>=23||9==e&&22>=t?8:9==e&&t>=23||10==e&&22>=t?9:10==e&&t>=23||11==e&&21>=t?10:11==e&&t>=22||12==e&&21>=t?11:12==e&&t>=22||1==e&&19>=t?12:0};e("#month, #day").change(function(){e("#constellation")[0].selectedIndex=t(e("#month").val(),e("#day").val())})},MOGU.User_Setting_PW_Init=function(){0!=e("#setting_form.setting_password").size()&&e("#setting_form.setting_password .green_button").click(function(){var t=e("#setting_form.setting_password input[name='oldpassword']").val(),i=e("#setting_form.setting_password input[name='newpassword']").val(),a=e("#setting_form.setting_password input[name='newpasswordagain']").val();return""==t?void alert("请输入现在的密码。"):""==i?void alert("请输入新密码。"):""==a?void alert("请再次输入新密码。"):i!=a?void alert("两次输入新密码不同，请检查。"):void e("#setting_form.setting_password form").submit()})},MOGU.User_Buyer_Verifier=function(){0!=e("#user_auth.buyer_auth").size()&&e("#buyer_auth .green_button").click(function(){e("#v_form").submit()})},MOGU.User_Setting_Bind=function(){e("#taobao_bind_form").size()>0&&(mgj_name=e("#uname").val(),taobao_name=e("#taobao_user_nick").val(),confirm("你的蘑菇街账号“"+mgj_name+"”将与淘宝账号“"+taobao_name+"”绑定，绑定后不能解绑，确定绑定")&&e("#taobao_bind_form").submit());var t=e("#errorbindmsg").val();"taobaoerror"==t&&alert("此淘宝账号已被其他蘑菇街账号绑定，请直接用淘宝账号在蘑菇街登陆查询。"),"taobaonologin"==t&&alert("该淘宝账号因广告行为已禁访，不允许二次绑定。");var i=e("#bind_type").val();if(""!=i&&e("#bind_type")[0]){var a="街";if("1"==MOGUPROFILE.is_subsite)var a="家";var s="",o="";if("wangyi"==i?(s="网易微博",o="/wangyi/delbind"):"sina"==i?(s="新浪微博",o="/sina/oauth/type/chabind"):"douban"==i?(s="豆瓣",o="/douban/oauth/type/chabind"):"tencent"==i?(s="腾讯微博",o="/tencent/chabind"):"renren"==i?(s="人人网",o="/renren/chabind"):"qq"==i&&(s="QQ空间",o="/qq/delbind"),"sina"==i)alert("抱歉，此新浪微博账号已绑定过其他蘑菇"+a+"账号。");else{var n="此"+s+"帐号已绑定过其他蘑菇"+a+"帐号，再次绑定会导致你的另一个帐号无法再用此"+s+"帐号登录蘑菇"+a+"，确认绑定？",r=confirm(n);r&&e("#myform").attr("action",o).submit()}}0!=e("#setting_form.account_bind").size()&&(e("#setting_form .bind_logo .binded").click(function(){e(".bind_box").hide();var t=e("#setting_form .bind_logo li").index(e(this).parents("li")[0]),i=e(this).attr("btype");e(".bind_box .bind_arrow").css("left",20+100*t),e("#setting_form p").hide(),e("."+i).show()}),e("#setting_form .bind_close a").click(function(){e(".bind_box").hide(),e("#setting_form p").show()}),e("#setting_form .bind_logo .bind").click(function(){e(".bind_box").hide();var t=(e("#setting_form .bind_logo li").index(e(this).parents("li")[0]),e(this).attr("btype")),i=e("#bind_renren").offset();e(".bind_box .bind_arrow").css("left",20),e(".renren").css({top:i.top+50,left:i.left}),e("#setting_form p").hide(),e("."+t).show()}),e(".bind_close a").click(function(){e(".bind_box").hide(),e("#setting_form p").show()}))},MOGU.User_Setting_Sync=function(){0!=e(".addSync").size()&&e(".addSync").click(function(){var t=this,i=e(this).attr("btype"),a=e(this).prev().find("input"),s=a[0].checked,o=a[1].checked,n=a[2].checked,r=a[3].checked;e.ajax({url:"/settings/modsync",type:"POST",timeout:6e4,data:{snsName:i,syncTweet:s?"1":"0",syncAlbum:o?"1":"0",syncTopic:n?"1":"0",syncHonor:r?"1":"0"},dataType:"json",success:function(i){if(null==i)alert(MGLANG.msgTimeout);else{var a=i.status.code,s=i.status.msg;1001==a?e(t).next(".addSuccess")[0]||e(t).after('<span class="addSuccess">设置成功</span>'):alert(s)}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)},complete:function(){}})})},MOGU.User_Mobile_Verifier=function(){if(0!=e("#user_auth.mobile_auth").size()){var t=e("#newMobileNo").val(),i=60,a=e("#user_auth .mobi_step2 .resent");e("#user_auth .mobi_step2 .green_text").val("");var s=function(){0==i?(a.text("重新发送"),a.css("color","#09e"),a.data("cansent","1")):(a.text("重新发送（"+i+"s）"),i--,setTimeout(s,1e3))};s(),a.click(function(){a.data("cansent")&&(e("#user_auth .pink_alert_m").remove(),e.ajax({url:"/usersecurity/ajaxmobilebindresend",type:"POST",timeout:6e4,dataType:"json",data:{newMobileNo:t,step:1},success:function(t){if(null==t)alert(MGLANG.msgTimeout);else{var o=t.status.code,n=t.status.msg;1205==o?(a.removeData("cansent"),a.text("重新发送（15s）"),a.css("color","#999"),i=15,s()):(e(".phone-check").siblings(".tip").remove(),e(".phone-check").after('<span class="wrong-tip tip>'+n+"</span>"))}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)}}))})}},MOGU.User_Setting_Publish_CoverPic=function(){e(".sbg_file").bind("change",function(){setTimeout(function(){e(".light_box").remove(),e(".s_b_success").hide(),e(".s_b_fail").hide();var t=null,i={title:"",lightBoxId:"lb_loading",ajax:!0,isBgClickClose:!1};loading_light_box=new MGLightBox(i),loading_light_box.init(),e("#lb_loading .lb_info .lb_l").text("封面上传中，请稍后......"),"www.mogujie.com"!=location.hostname?(e("#coverForm").append('<input type="hidden" value="'+location.host+'" name="host">'),e("#coverForm").attr("action","/upload/addpic")):e("#coverForm").attr("action","http://upload.mogujie.com/upload/addpic"),e("#coverForm").append('<input type="hidden" value="cover_photo_success" name="callback">'),e("#coverForm").append('<input type="hidden" value="bookcover" name="type">'),0==e("#ifr_picup").size()&&e("body").append('<div style="display: none;"><iframe frameborder="0" name="ifr_picup" id="ifr_picup" src="about:blank"></iframe></div>'),e("#coverForm").attr("target","ifr_picup"),e("#coverForm").attr("enctype","multipart/form-data"),e("#coverForm").submit();var a=0;t=setInterval(function(){60==a&&(e("#ifr_picup").parent().remove(),alert(MGLANG.msgTimeout),loading_light_box.close(),clearInterval(t)),a++},1e3),window.cover_photo_success=function(i,a,s,o){if(clearInterval(t),1001!=i)return void alert(a);var n=e(".coverImg"),r=o+"_960x400."+MGTOOL.getPicExtension(o),c='<img class="upimg" src="'+r+'" /><input type="hidden" id="coverImgId" value="'+s+'"/>';loading_light_box.close(),n.html(c)}},0)})},MOGU.User_Setting_Cover=function(){e(".setting_domain").size()>0||(e("input[name=defaultFilter]").click(function(){e(".s_b_fail").hide(),e(".s_b_success").hide()}),e("input,textarea").focus(function(){e(".s_b_fail").hide(),e(".s_b_success").hide(),e(this).css({"border-color":"#83b900"})}).blur(function(){e(this).css({"border-color":"#cfcfcf"})}),e("#save").click(function(){{var t=e("#coverImgId").val(),i=e("input[name=defaultFilter]:checked").val();MOGUPROFILE.userid}return t?void e.ajax({url:"/settings/subcustom",type:"POST",timeout:6e4,data:{coverImgId:t,defaultFilter:i},dataType:"json",success:function(t){if(null==t)alert(MGLANG.msgTimeout);else{var i=t.status.code,a=t.status.msg;1001==i?(e(".s_b_fail").hide(),e(".s_b_cancle").show(),e(".s_b_success").show()):(e(".s_b_success").hide(),e(".s_b_f").text(a),e(".s_b_fail").show())}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)}}):void alert("请上传图片")}),e(".s_b_cancle").click(function(){e.ajax({url:"/settings/cancelcover",type:"POST",timeout:6e4,dataType:"json",success:function(t){if(null==t)alert(MGLANG.msgTimeout);else{{var i=t.status.code;t.status.msg}1001==i?window.location.reload():(e(".s_b_success").hide(),e(".s_b_fail").show())}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)}})}))},MOGU.User_Setting_Domain=function(){0!=e(".setting_domain").size()&&(e(".setting_domain .gray_text").focus(function(){e(this).css("border-color","#83b900"),e(".notice_span").show()}).blur(function(){e(this).css("border-color","#cfcfcf")}),e("#setdomain").click(function(){var t=e(".setting_domain .gray_text").val();e.ajax({url:"/settings/checkdomain",type:"POST",timeout:6e4,data:{domain:t},dataType:"json",success:function(t){if(null==t)alert(MGLANG.msgTimeout);else{var i=t.status.code,a=t.status.msg,s=!1,o="";switch(i){case 1001:o='<img src="/img/ok_01.png" />',s=!0;break;case 76001:o='<img src="/img/error_01.png" />'+a;break;case 76002:o='<img src="/img/error_01.png" />'+a;break;case 76003:o='<img src="/img/error_01.png" />'+a;break;case 76004:o='<img src="/img/error_01.png" />'+a}if(e(".notice_span").html(o),1!=s)return!1;e(".setting_domain .setting_domain_form").submit()}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)}})}))},MOGU.User_Address_Set=function(){e(".setaddress").click(function(){var t={province:e("#enterprise_province").find("option:selected").text(),city:e("#enterprise_city").find("option:selected").text(),area:e("#enterprise_area").find("option:selected").text(),address:e("input[name=address]").val(),zip:e("input[name=zip]").val(),mobile:e("input[name=mobile]").val(),realname:e("input[name=realname]").val(),is_check:1},i="/settings/addrdata";e.ajax({url:i,type:"POST",data:t,timeout:6e4,dataType:"json",success:function(i){1==i.result.iserror?(1==i.result.province||1==i.result.city||1==i.result.area?e(".pca_tips").show():e(".pca_tips").hide(),1==i.result.address?e(".address_tips").show():e(".address_tips").hide(),1==i.result.zip?e(".zip_tips").show():e(".zip_tips").hide(),1==i.result.mobile?e(".mobile_tips").show():e(".mobile_tips").hide(),1==i.result.realname?e(".realname_tips").show():e(".realname_tips").hide()):0==i.result.iserror&&(e(".e_t").hide(),e.ajax({url:"/settings/setaddress",data:t,timeout:6e4,dataType:"json",type:"POST",success:function(){e(".green_alert_l").show()}}))}})})},MOGU.User_Blacklist_Del=function(){e(".blacklist .bl_bd li .del").click(function(){var t=e(this),i=t.attr("uid");return confirm("你确定将该用户移除黑名单？")?void e.ajax({url:"/collect/unblacklist",type:"POST",timeout:6e4,data:{unblacklistid:i},dataType:"json",success:function(i){if(null==i)alert(MGLANG.msgTimeout);else{var a=i.status.code,s=i.status.msg;1001==a?t.parents("li").slideUp(500,function(){e(this).remove()}):alert(s)}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)}}):!1})},MOGU.User_Blacklist_Del(),MOGU.User_Setting_Avartar(),MOGU.User_Setting_Base_Init(),MOGU.User_Setting_PW_Init(),MOGU.User_Buyer_Verifier(),MOGU.User_Mobile_Verifier(),MOGU.User_Setting_Bind(),MOGU.User_Setting_Sync(),MOGU.User_Setting_Cover(),MOGU.User_Setting_Publish_CoverPic(),MOGU.User_Setting_Person_Style(),MOGU.Xingzuo_Pipei(),MOGU.User_Setting_Domain(),MOGU.User_Address_Set(),e(document).ready(function(){0!=e(".setting_welfare").size()&&(MOGU.SLE_A("enterprise[province]","enterprise[city]","enterprise[area]"),e.ajax({url:"/settings/getregion",type:"GET",dataType:"json",timeout:6e4,success:function(t){1001==t.status.code&&(e("#enterprise_province > option").each(function(){-1!=e(this).attr("value").indexOf(t.result.province)&&e(this).attr("selected","selected").change()}),e("#enterprise_city > option").each(function(){-1!=e(this).attr("value").indexOf(t.result.city)&&e(this).attr("selected","selected").change()}),e("#enterprise_area > option").each(function(){-1!=e(this).attr("value").indexOf(t.result.area)&&e(this).attr("selected","selected")}))}}))}),MOGU.Setting_School_Info=function(){e(".chose_school").click(function(){if(e("#lb_chose_school")[0])return void e("#lb_chose_school").show();var t={title:"选择学校",lightBoxId:"lb_chose_school",ajax:!0,isBgClickClose:!1};loading_light_box=new MGLightBox(t),loading_light_box.init(),e.ajax({url:"/settings/personal/getschoollist",type:"POST",timeout:6e4,data:{},dataType:"json",success:function(t){if(null==t)alert(MGLANG.msgTimeout);else{var a=t.status.code,n=t.status.msg;if(1001==a){var r='<div class="clearfix"><input type="text" class="r3 fl search_val" value="请输入学校名称" def-v="请输入学校名称"><a href="javascript:;" class="fl search_btn"></a></div>',c=t.result.provs,l='<div class="mt10 provs_info">';for(var u in c)l+='<a href="javascript:;" >'+c[u]+"</a>";r+=l+"</div>";var _=t.result.univs,d='<ul class="school_list ">';for(var u in _)d+='<li><a title="'+_[u]+'" href="javascript:;" >'+_[u]+"</a></li>";r+=d+"</ul>",r+='<div class="other_op"><a href="javascript:;" class="close_school"></a></div>',loading_light_box.buildContent(r),i(),s(),o(),MOGU.Globe_Input_Text(e("#lb_chose_school .search_val"))}else alert(n)}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)},complete:function(){}});var i=function(){e(".provs_info a").click(function(){e(".provs_info a").removeClass("c");var t=e(this),i={provs:t.text()};n(i),t.addClass("c")})},a=function(){e("#lb_chose_school .close_school").live("click",function(){loading_light_box.close()})};a();var s=function(){e("#lb_chose_school .school_list a").click(function(){e("#school_info .chose_school").val(e(this).text()),loading_light_box.close()})},o=function(){e("#lb_chose_school .search_btn").click(function(){var t=e("#lb_chose_school .search_val").val(),i={seachkey:t};n(i)})},n=function(t){e.ajax({url:"/settings/personal/getschoollist",type:"POST",timeout:6e4,data:t,dataType:"json",success:function(t){if(null==t)alert(MGLANG.msgTimeout);else{var i=t.status.code,a=t.status.msg;if(1001==i){var o=t.result.univs,n="";for(var r in o)n+='<li><a title="'+o[r]+'" href="javascript:;" >'+o[r]+"</a></li>";e("#lb_chose_school .school_list ").html(n),s()}else alert(a)}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)},complete:function(){}})}}),MOGU.Globe_Input_Text(e("#school_info input[name=department]"),"请输入院系名称")},MOGU.Setting_School_Info(),jQuery(document).ready(function(e){e("input[name='validCode']").focus(function(){e(this).siblings(".tip").remove()}),e("input[name='oldPwd']").focus(function(){e(this).siblings(".tip").remove()}),e("input[name='validCode']").focus(function(){e(this).siblings(".tip").remove()});var t=function(){e("#resetpassword .gray_text").val(""),e("#resetpassword .tip").remove()};if(e(".reset").click(function(){t()}),e("#resetpassword").length>0){new MOGU.validation("#resetpassword",{btnSubmit:".submit",ajaxPost:!0,callback:function(i,a){if(1001===a.status.code){var s={lightBoxId:"success",scroll:!0,isBgClickClose:!1},o=new MGLightBox(s);o.init(),o.success_close("修改成功",800),t(),e("#checkcode_change").click()}else if(4004===a.status.code)switch(a.result.errorType){case 1:i.showerreo(e("#checkcode_change"),a.result.msg),e("#checkcode_change").click();break;case 2:i.showerreo(e("input[name='oldPwd']"),a.result.msg);break;case 3:i.showerreo(e("#password"),a.result.msg);break;case 4:i.showerreo(e("#password"),a.result.msg);break;case 5:i.showerreo(e("#password"),a.result.msg);break;case 6:i.showerreo(e("input[name='oldPwd']"),a.result.msg)}else{var s={lightBoxId:"success",scroll:!0,isBgClickClose:!1},o=new MGLightBox(s);o.init(),o.fail(a.status.msg,800)}}})}}),MOGU.Globe_Checkcode_Change=function(){0!=e("#checkcode_change").size&&e("#checkcode_change").click(function(){e.ajax({url:"/users/recaptcha",type:"POST",timeout:6e4,data:"{}",dataType:"json",success:function(t){if(null==t)alert(MGLANG.msgTimeout);else{var i=t.status.code,a=t.status.msg;if(1001==i){var s=t.result.data.captchaId,o=t.result.data.captchaSrc;e("#img_checkcode").attr("src",o),e("#captcha-id").val(s)}else alert(a)}},error:function(e,t){"timeout"==t&&alert(MGLANG.msgTimeout)}})})},MOGU.Globe_Checkcode_Change()}(jQuery);jQuery(document).ready(function(a){var b=a("#coupon_prompt_wrap"),c=new Date,d=c.getDate();if(b.size()>0){if(d==window.store.get("isOrderCouponPrompt"))return;b.show(),b.on("click",".prompt_close",function(a){a.preventDefault(),b.hide(),window.store.set("isOrderCouponPrompt",d)})}});