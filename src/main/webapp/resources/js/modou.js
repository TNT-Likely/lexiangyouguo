define("pages/modou/modouv2",[],function(){function n(n,t){var e=n,s={title:t,lightBoxId:"output",contentHtml:e,scroll:!1,isBgClickClose:!1},p=new MGLightBox(s);p.init()}var t=['<div class="modou_box">','<p class="text1">今日蘑豆领取成功</p>','<p class="text2">记得明天再来领哦~</p>','<a class="box_btn" href="javascript:;">确定</a>',"</div>"].join(""),e="签到领蘑豆",s=['<div class="modou_box">','<p class="text3">菇凉，你将用<span class="num1"></span>粒蘑豆兑换<span class="num2"></span>元优惠券~</p>','<div class="change_btn clearfix">','<a class="box_btn fl" id="changeYes" href="javascript:;">确认兑换</a>','<a class="box_btn cancel_btn fl" id="changeNo" href="javascript:;">取消兑换</a>',"</div>","</div>"].join(""),p="蘑豆兑换",o=['<div class="modou_box">','<p class="text1">恭喜菇凉！兑换成功</p>','<p class="text2">有效期：<span id="startDate"></span>至<span id="endDate"></span></p>','<a class="box_btn" href="javascript:;">去逛逛</a>',"</div>"].join(""),a="蘑豆兑换",i=['<div class="modou_box">','<p class="text1">对不起~兑换失败</p>','<p class="text2" id="changeFail"></p>','<a class="box_btn" href="javascript:;">确认</a>',"</div>"].join(""),d="蘑豆兑换";$(".get_btn").on("click",function(){var s=$(".modou_total_num").text(),p=$(".get_num").text();$.ajax({url:"/trade/credit/modouv2/signin",data:{},dataType:"json",type:"POST",success:function(o){var a=o.status,i=o.result;if(1001==a){n(t,e);var d=parseInt(s)+parseInt(p);$(".modou_total_num").text(d),$(".modou_total_money").text("下单可抵现"+(d/100).toFixed(2)+"元"),$(".box_btn").on("click",function(){$(".lb_close").trigger("click")}),$(".base_info_get .text_n").remove(),$(".base_info_get .utext_link_wrap").before('<p class="get_text text_h">今日已领取<span class="get_num">'+p+'</span>粒，明天可领更多哦</p><p class="modou_remind">去手机端领蘑豆，直接翻倍~</p>')}else $.alert(i)}})}),$(".change_start").on("click",function(){var t=this,e=$(t).attr("data-idstr"),l=$(t).find(".modou_num").text(),c=$(t).parents(".voucher_box").find(".num").text(),u=$(".modou_total_num").text(),r=$(t).parents(".shop_info").find(".shop_name span");n(s,p),$(".num1").text(l),$(".num2").text(c);var _=$(t).parents(".shop_info").find(".start_date").text(),m=$(t).parents(".shop_info").find(".end_date").text();$("#changeYes").on("click",function(){$.ajax({url:"/trade/credit/modouv2/exchangecoupon",data:{idStr:e},dataType:"json",type:"POST",success:function(e){var s=e.status,p=e.result;1001==s?($(".lb_close").trigger("click"),n(o,a),$("#startDate").text(_),$("#endDate").text(m),$(".modou_total_num").text(parseInt(u)-parseInt(l)),$(t).before('<p class="change_btn change_end">已兑换</p>'),$(t).remove(),$(".box_btn").on("click",function(){$(".lb_close").trigger("click"),r.trigger("click")})):($(".lb_close").trigger("click"),n(i,d),$("#changeFail").text(p),$(".box_btn").on("click",function(){$(".lb_close").trigger("click")}))}})}),$("#changeNo").on("click",function(){$(".lb_close").trigger("click")})})}),define("text",{load:function(n){throw new Error("Dynamic load not allowed: "+n)}}),define("text!pages/modou/module/popup/Popup.tpl",[],function(){return"/**\n * Created by zhexi on 14-10-10.\n */\n\n<div id='{{=it._id}}' class='pp_popup'>\n    <style>\n\n    </style>\n    <div class='pp_mask'></div>\n    <div class='pp_content'>\n        {{? it._template}}\n            {{#def.template}}\n        {{??}}\n        <div class='pp_title'>\n            <span>选择现金券</span>\n        </div>\n        <div class='pp_con'>\n            <span>选择现金券</span>\n        </div>\n        <div class='pp_btn_wrap'>\n            <span class=\"pp_btn pp_btn_yes\">确定</span>\n        </div>\n        {{?}}\n    </div>\n</div>\n"}),define("pages/modou/module/popup/Popup",["text!pages/modou/module/popup/Popup.tpl"],function(n){var t=function(n,t,e,s,p,o){this.id=n,this.$elHost=e,this.$panel=null,this.$elContainter=t,this.template=s,this.data=p||{},this.data._id=n,this.callback=o,this.init()};return t.prototype={constructor:t,init:function(){},bindEvents:function(){var n=this.$elContainter.find("#"+this.id);this.$panel=n;var t=this;this.$elHost&&n.on("click",this.$elHost,function(){t.show()}),n.on("click",".pp_mask",function(){t.hide()}),n.on("click",".pp_btn_yes",function(){t.hide()}),n.on("click",".pp_close",function(){t.hide()}),$(window).on("scroll",n,function(){n.css("top",$(window).scrollTop()+"px")})},hide:function(){return this.$panel.remove(),!1},show:function(){var t=n.replace("{{#def.template}}",this.data._template),e=MoGu.ui.getTemplate(t,this.data,{template:this.data._template});this.$elContainter.append(e),this.bindEvents();var s=this.$elContainter.find("#"+this.id);return s.css("top",$(window).scrollTop()+"px"),s.on("touchmove",s,function(){return!1}),s.find(".pp_mask").height($("body").height()).css("top","-"+$(window).scrollTop()+"px"),!1}},function(e,s,p,o,a,i){return a=a||{},a._template=o,new t(e,s,p,n,a,i)}}),define("text!pages/modou/module/popup/popup.css",[],function(){return".pp_popup {\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 100; }\n  .pp_popup .pp_mask {\n    position: absolute;\n    width: 100%;\n    background-color: rgba(172, 172, 172, 0.5); }\n  .pp_popup .pp_content {\n    z-index: 100;\n    width: 470px;\n    margin-left: -235px;\n    position: absolute;\n    top: 18%;\n    _top: 150px;\n    left: 50%;\n    border-radius: 3px;\n    background-color: #ffffff; }\n    .pp_popup .pp_content .pp_header {\n      color: #666666;\n      position: relative;\n      padding-left: 15px;\n      line-height: 40px;\n      height: 40px;\n      font-size: 14px;\n      background: #f8f8f8;\n      border-bottom: 1px solid #ededed;\n      border-radius: 3px; }\n    .pp_popup .pp_content .pp_close {\n      color: #999999;\n      position: absolute;\n      right: 0;\n      top: 0;\n      height: 40px;\n      font-size: 15px;\n      line-height: 40px;\n      display: inline-block;\n      margin-right: 5px;\n      padding: 0 10px;\n      cursor: pointer; }\n    .pp_popup .pp_content .pp_title {\n      text-align: center;\n      color: #ff4163;\n      font-size: 15px;\n      padding: 14px; }\n    .pp_popup .pp_content .pp_sub_title {\n      color: #424242;\n      padding: 0 23px; }\n    .pp_popup .pp_content .pp_con {\n      text-align: center; }\n    .pp_popup .pp_content .pp_btn_wrap {\n      margin-top: 15px;\n      margin-bottom: 30px;\n      text-align: center; }\n    .pp_popup .pp_content .pp_btn {\n      width: 120px;\n      height: 38px;\n      line-height: 38px;\n      display: inline-block;\n      font-size: 15px;\n      border-radius: 3px;\n      margin: 0 5px;\n      cursor: pointer; }\n    .pp_popup .pp_content .pp_btn_yes {\n      color: #fff;\n      background: #ff5777; }\n"}),define("text!pages/modou/tpl/js/sku.tpl",[],function(){return'<div class="pp_header">\n    <span>\n    {{? it.title}}\n        现在完善信息，每周三10:00直接抢\n    {{??}}\n        秒杀中\n    {{?}}\n    </span>\n    <span class="pp_close fr">x</span>\n</div>\n<div class=\'pp_con\'>\n    {{? it.stock_options.styles.name }}\n    <div id="style_id" class=\'clearfix pp_con_sub\' style=\'margin-top: 30px;\'>\n        <div class=\'fl\'><span class="pp_con_title">{{=it.stock_options.styles.name}}:</span></div>\n        <div style=\'margin-left:76px;\'>\n        {{~it.stock_options.styles.values:value}}\n        <span class="pp_con_item" data-style_id="{{=value.styleId}}">{{=value.value}}</span>\n        {{~}}\n        </div>\n    </div>\n    {{?}}\n    {{? it.stock_options.sizes.name }}\n    <div id="size_id"  class=\'clearfix pp_con_sub\'>\n        <div class=\'fl\'><span class="pp_con_title">{{=it.stock_options.sizes.name}}:</span></div>\n        <div style=\'margin-left:76px;\'>\n        {{~it.stock_options.sizes.values:value}}\n        <span class="pp_con_item" data-size_id=\'{{=value.sizeId}}\'>{{=value.value}}</span>\n        {{~}}\n        </div>\n    </div>\n    {{?}}\n</div>\n<div class=\'pp_btn_wrap\'>\n    <span class="pp_btn pp_btn_yes">确认</span>\n    <span class="pp_checkyp pp_btn pp_btn_yes">查看详情</span>\n</div>\n'}),define("text!pages/modou/tpl/js/modouLack.tpl",[],function(){return'<div class="pp_header">\n    <span>秒杀失败</span>\n    <span class="pp_close fr">x</span>\n</div>\n<div class=\'pp_title\' style="margin-top:40px;color:#333333;">\n    <span>蘑豆数量不够，秒杀失败！</span>\n</div>\n<div class=\'\' style="text-align:center;">\n    <p style="margin:10px 0 20px 0">\n        <a href="http://www.mogujie.com/act/0925mdglsjmeiyi"><span class="">快去攒蘑豆 ></span></a>\n    </p>\n</div>\n<div class=\'pp_btn_wrap\'>\n    <span class="pp_btn pp_btn_yes">确定</span>\n</div>\n'}),define("text!pages/modou/tpl/js/modouGone.tpl",[],function(){return'<div class="pp_header">\n    <span>已抢完</span>\n    <span class="pp_close fr">x</span>\n</div>\n<div class=\'pp_title\' style="margin:40px 0;color:#333333;">\n    <span>迟了一步，没抢到哎~</span>\n</div>\n<div class=\'pp_btn_wrap\'>\n    <span class="pp_btn pp_btn_yes">确定</span>\n</div>\n'}),define("text!pages/modou/tpl/js/address.tpl",[],function(){return"<style>\n.pp_con{\n    padding: 0 52px;\n}\n.pp_con p{\n    color:#727272;\n    font-size:14px;\n    margin: 20px 0;\n}\n.pp_con input{\n    padding:5px;\n    border:1px solid #dddddd;\n    width: 280px;\n}\n</style>\n<div class=\"pp_header\">\n    <span>秒杀成功</span>\n    <span class=\"pp_close fr\">x</span>\n</div>\n<div class='pp_title' style='font-size:18px;padding-bottom: 14px !important;'>\n    <span>恭喜秒杀成功！务必完善以下信息才能发货哦</span>\n</div>\n<div class='pp_con' >\n    <p >\n        <span class=\"\">真实姓名:</span>\n        <input id='pp_receive_name' type='text' value='{{=it.receiveName||\"\"}}' />\n    </p>\n    <p >\n        <span class=\"\">所在地区:</span>\n        <input id='pp_area' type='text' value='{{=(it.province+it.city+it.area)||\"\"}}' />\n    </p>\n    <p >\n        <span class=\"\">街道地址:</span>\n        <input id=\"pp_address\" type='text' value='{{=it.address||\"\"}}' />\n    </p>\n    <p >\n        <span class=\"\">联系电话:</span>\n        <input id='pp_mobile' type='text' value='{{=it.mobile||\"\"}}' />\n    </p>\n</div>\n<div class='pp_btn_wrap'>\n    <span class=\"pp_btn pp_btn_yes\">确认</span>\n</div>\n"}),define("text!pages/modou/tpl/js/modouSucess.tpl",[],function(){return'<div class="pp_header">\n    <span>秒杀成功</span>\n    <span class="pp_close fr">x</span>\n</div>\n<div class=\'pp_title\' style="margin-top:40px;color:#333333;">\n    <span>恭喜菇凉！秒杀成功！</span>\n</div>\n<div class=\'\' style="text-align:center;">\n    <p style="margin:10px 0 20px 0">\n        <span class="">预计5个工作日内发货<br/>继续下一场</span>\n    </p>\n</div>\n<div class=\'pp_btn_wrap\'>\n    <span class="pp_btn pp_btn_yes">确定</span>\n</div>\n'}),define("text!pages/modou/css/sku.css",[],function(){return".pp_title {\n  padding-bottom: 0 !important; }\n\n.pp_con {\n  text-align: left !important; }\n  .pp_con .pp_con_sub {\n    margin: 20px 0; }\n\n.pp_con_item {\n  display: inline-block;\n  padding: 0 8px;\n  border: 1px solid #ddd;\n  line-height: 28px;\n  height: 28px;\n  float: left;\n  margin-right: 10px;\n  margin-bottom: 10px;\n  cursor: pointer; }\n\n.pp_choose {\n  border: 1px #ff4163 solid; }\n\n.pp_con_title {\n  line-height: 28px;\n  font-size: 12px;\n  color: #424242;\n  font-weight: bold;\n  text-align: left;\n  padding: 0 14px;\n  padding-left: 55px; }\n"}),require(["pages/modou/modouv2","pages/modou/module/popup/Popup","text!pages/modou/module/popup/popup.css","text!pages/modou/tpl/js/sku.tpl","text!pages/modou/tpl/js/modouLack.tpl","text!pages/modou/tpl/js/modouGone.tpl","text!pages/modou/tpl/js/address.tpl","text!pages/modou/tpl/js/modouSucess.tpl","text!pages/modou/css/sku.css","widgets/pc/timeCountDown/timeCountDown"],function(n,t,e,s,p,o,a,i,d,l){$("head").append("<style>"+e+d+"</style>"),$(".today_countdown").length>0&&$(".today_countdown").each(function(){new l({timeValue:$(".today_countdown").data("left_sec"),parentNode:$(this),format:"{hh}小时{mm}分{ss}秒"}).onSuccess(function(){$(".goodToday").find(".buy_item_info_wrap").remove(),$(".goodToday").find(".item_going").removeClass("item_going").addClass("item_now")})}),$(".goodToday").on("click",".item_now",function(){var n=$(this).parents(".buy_item.goodToday"),e=n.data("sku_id"),d=n.data("id"),l=$(this);if(l.data("doing"))return!1;if("0"==e){var c=parseInt($(".modou_total_num").text()),u=parseInt(n.find(".item_modou").text());if(u>c){var r=new t("pp_buy_modou_lack",$("body"),null,p,null);return r.show(),!1}var _=n.data("trade_item_id");l.data("doing",!0),$.ajax({url:"http://www.mogujie.com/trade/credit/modouv2/sku?_ajax=true&tradeitemid="+_,dataType:"json"}).then(function(e){if(l.data("doing",!1),1001===e.status.code){var p=new t("pp_buy_now",$("body"),null,s,e.result);p.show();var r=null,_=null;$("#pp_buy_now").on("click",".pp_con_item",function(){$(this).hasClass("pp_choose")||($(this).siblings().removeClass("pp_choose"),$(this).addClass("pp_choose"),$(this).data("style_id")?r=$(this).data("style_id"):_=$(this).data("size_id"))}),$("#pp_buy_now").off("click",".pp_btn_yes"),$("#pp_buy_now").on("click",".pp_btn_yes",function(){var s=$(this);if(s.data("doing"))return!1;if($(this).hasClass("pp_checkyp"))return location.href=n.find(".item_pic").attr("href"),!1;if(null===r&&$("#style_id").length>0)return alert("请选择颜色"),!1;if(null===_&&$("#size_id").length>0)return alert("请选择尺寸"),!1;for(var l=e.result.stock_info,m=0,f=l.length;f>m;m++){var g=l[m];if($("#style_id").length>0&&0===$("#size_id").length&&g.styleId==r||$("#size_id").length>0&&0===$("#style_id").length&&g.sizeId==_||$("#size_id").length>0&&$("#style_id").length>0&&g.styleId==r&&g.sizeId==_){s.data("doing",!0),$.ajax({url:"http://www.mogujie.com/trade/credit/modouv2/getgoods",data:{skuid:g.id,id:d},dataType:"json"}).then(function(e){if(s.data("doing",!0),1001===e.status.code)if(0!=e.result.code){n.find(".item_btn").removeClass("item_now").addClass("item_success"),$(".modou_total_num").text(c-u),$(".modou_total_money").text("下单可抵现"+((c-u)/100).toFixed(2)+"元"),0===e.result.left?n.find(".item_amount").remove():n.find(".item_amount span").text(e.result.left),p.hide();var d=new t("pp_buy_modou_gone",$("body"),null,a,e.result.address);d.show(),$("#pp_buy_modou_gone").off("click",".pp_btn_yes"),$("#pp_buy_modou_gone").on("click",".pp_btn_yes",function(){var n=$("#pp_receive_name").val(),s=$("#pp_area").val(),p=$("#pp_address").val(),o=$("#pp_mobile").val(),a=$("#pp_zip").val(),l=e.result.code,c={name:n,area:s,address:p,mobile:o,zip:a,code:l};return $.ajax({url:"http://www.mogujie.com/trade/credit/modouv2/saveaddr",data:c,dataType:"json"}).done(function(n){1001===n.status.code&&(d.hide(),new t("pp_buy_modou_success",$("body"),null,i,null).show())}).fail(function(){alert("请求出错!")}),!1})}else p.hide(),new t("pp_buy_modou_gone",$("body"),null,o,null).show(),n.find(".item_btn").removeClass("item_now").addClass("item_gone");else MoGu.ui.hideLoading(),alert(e.status.msg)},function(){MoGu.ui.hideLoading(),alert("请求出错!")});break}}return!1})}else l.data("doing",!1),alert(e.status.msg)},function(){l.data("doing",!0)})}else l.data("doing",!0),$.ajax({url:"http://www.mogujie.com/trade/credit/modouv2/getgoods",data:{skuid:e,id:d},dataType:"json"}).then(function(e){if(l.data("doing",!1),1001===e.status.code)if(0!=e.result.code){n.find(".item_btn").removeClass("item_now").addClass("item_success"),$(".modou_total_num").text(c-u),0===e.result.left?n.find(".item_amount").remove():n.find(".item_amount span").text(e.result.left);var s=new t("pp_buy_modou_gone",$("body"),null,a,e.result.address);s.show(),$("#pp_buy_modou_gone").off("click",".pp_btn_yes"),$("#pp_buy_modou_gone").on("click",".pp_btn_yes",function(){var n=$("#pp_receive_name").val(),p=$("#pp_area").val(),o=$("#pp_address").val(),a=$("#pp_mobile").val(),d=$("#pp_zip").val(),l=e.result.code,c={name:n,area:p,address:o,mobile:a,zip:d,code:l};return $.ajax({url:"http://www.mogujie.com/trade/credit/modouv2/saveaddr",data:c,dataType:"json"}).done(function(n){1001===n.status.code&&(s.hide(),new t("pp_buy_modou_success",$("body"),null,i,null).show())}).fail(function(){alert("请求出错!")}),!1})}else new t("pp_buy_modou_gone",$("body"),null,o,null).show(),n.find(".item_btn").removeClass("item_now").addClass("item_gone");else l.data("doing",!1),alert(e.status.msg)},function(){l.data("doing",!1),alert("请求出错!")})}),$(".goodTomorrow").on("click",".item_t_add",function(){if($(this).data("doing"))return!1;var n=$(this),e=$(this).parents(".buy_item.goodTomorrow"),p=e.data("sku_id"),o=e.data("id");if("0"==p){var a=e.data("trade_item_id"),o=e.data("id");n.data("doing",!0),$.ajax({url:"http://www.mogujie.com/trade/credit/modouv2/sku?_ajax=true&tradeitemid="+a,dataType:"json"}).then(function(p){if(n.data("doing",!1),1001===p.status.code){p.result.title=!0;var a=new t("pp_buy_sku",$("body"),null,s,p.result);a.show();var i=null,d=null;$("#pp_buy_sku").on("click",".pp_con_item",function(){$(this).hasClass("pp_choose")||($(this).siblings().removeClass("pp_choose"),$(this).addClass("pp_choose"),$(this).data("style_id")?i=$(this).data("style_id"):d=$(this).data("size_id"))}),$("#pp_buy_sku").off("click",".pp_btn_yes"),$("#pp_buy_sku").on("click",".pp_btn_yes",function(){var n=$(this);if(n.data("doing"))return!1;if($(this).hasClass("pp_checkyp"))return window.open(e.find(".item_pic").attr("href")),!1;if(null===i&&$("#style_id").length>0)return alert("请选择颜色"),!1;if(null===d&&$("#size_id").length>0)return alert("请选择尺寸"),!1;for(var t=p.result.stock_info,s=0,l=t.length;l>s;s++){var c=t[s];($("#style_id").length>0&&0===$("#size_id").length&&c.styleId==i||$("#size_id").length>0&&0===$("#style_id").length&&c.sizeId==d||$("#size_id").length>0&&$("#style_id").length>0&&c.styleId==i&&c.sizeId==d)&&(n.data("doing",!0),$.ajax({url:"http://www.mogujie.com/trade/credit/modouv2/savesku",data:{skuid:c.id,id:o},dataType:"json"}).then(function(t){n.data("doing",!1),1001===t.status.code?(e.find(".item_btn").removeClass("item_t_add").addClass("item_t_going"),a.hide(),alert("保存成功!")):alert(t.status.msg)}))}})}else alert(p.status.msg)},function(){n.data("doing",!1),alert("请求出错!")})}})});