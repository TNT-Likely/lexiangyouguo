define("pages/pay/cashier/js/base64",[],function(){var e={enKey:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",deKey:new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1),encode:function(e){for(var t,a,n,i=new Array,o=0;o+3<=e.length;)t=e.charCodeAt(o++),a=e.charCodeAt(o++),n=e.charCodeAt(o++),i.push(this.enKey.charAt(t>>2),this.enKey.charAt((t<<4)+(a>>4)&63)),i.push(this.enKey.charAt((a<<2)+(n>>6)&63),this.enKey.charAt(63&n));return o<e.length&&(t=e.charCodeAt(o++),i.push(this.enKey.charAt(t>>2)),o<e.length?(a=e.charCodeAt(o),i.push(this.enKey.charAt((t<<4)+(a>>4)&63)),i.push(this.enKey.charAt(a<<2&63),"=")):i.push(this.enKey.charAt(t<<4&63),"==")),i.join("")},urlsafeEncode:function(e){var t=this.encode(e);return t=t.replace("+","-").replace("/","_")},decode:function(e){var t,a,n,i,o=new Array,r=0;for(e=e.replace(/[^A-Za-z0-9\+\/]/g,"");r+4<=e.length;)t=this.deKey[e.charCodeAt(r++)],a=this.deKey[e.charCodeAt(r++)],n=this.deKey[e.charCodeAt(r++)],i=this.deKey[e.charCodeAt(r++)],o.push(String.fromCharCode((t<<2&255)+(a>>4),(a<<4&255)+(n>>2),(n<<6&255)+i));return r+1<e.length&&(t=this.deKey[e.charCodeAt(r++)],a=this.deKey[e.charCodeAt(r++)],r<e.length?(n=this.deKey[e.charCodeAt(r)],o.push(String.fromCharCode((t<<2&255)+(a>>4),(a<<4&255)+(n>>2)))):o.push(String.fromCharCode((t<<2&255)+(a>>4)))),o.join("")},urlsafeDecode:function(e){e=e.replace("-","+").replace("_","/");var t=this.decode(e);return t}};return e}),define("pages/pay/cashier/js/cardno",["pages/pay/cashier/js/base64"],function(e){var t=function(){var t={lightBoxId:"lb_bank_cardnopop",title:"请输入银行卡号",isBgClickClose:!1},a=null,n=$("#J_cashierForm"),i=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},o=function(t,o){var r=$(".J_cardno_tip").eq(0);r.length<=0&&(r=$('<span class="cardno_tip J_cardno_tip"></span>'),$("body").append(r));var c=t.find(".J_cardNoInput"),s=t.find(".J_notice"),d=$(".J_banklist").find("input:checked");t.off("click").on("click",".J_otherBank",function(e){e.preventDefault(),a&&a.close()}),t.off("focus").off("blur").off("keyup").on("focus",".J_cardNoInput",function(){var e=$(this);r.css({top:e.offset().top-16-8-1,left:e.offset().left})}).on("blur",".J_cardNoInput",function(){r.hide()}).on("keyup",".J_cardNoInput",function(){var e=$(this),t=e.val().replace(/\s/g,"").replace(/(\d{4})(?=\d)/g,"$1 ");""!==t?r.show():r.hide(),r.html(t)}),t.on("click",".J_next",function(t){t.preventDefault(),s.html("");var r=c.val(),l=$(".J_banklist").find("input:checked").eq(0).attr("id");if(""===r||isNaN(r))return void s.html("请填写正确的银行卡号");var u=e.encode(i(r));$.ajax({url:"/trade/orderpay/bankCardType",type:"POST",data:{type:l,cardno:u},dataType:"json",success:function(e){if(e&&e.status&&e.status.code)switch(e.status.code){case 1001:2===e.result&&d.attr("value",d.attr("data-cvalue")),$("#J_cardno_v").remove(),n.append('<input type="hidden" name="cardno" id="J_cardno_v" value="'+u+'">'),a.close(),$(".light_box_fullbg").remove(),o&&o(!0);break;case 1111:default:s.html(e.result||e.status.msg)}else s.html("网络错误，请稍后再试")},error:function(){s.html("网络错误，请稍后再试")}})})};return{show:function(e,n){t.closeCallBack=n||function(){},t.contentHtml=MoGu.ui.getTemplate($("#tpl_bankcardno").html(),{bankImgPath:i(e)}),a=new MGLightBox(t),a.init(),o(a.getBoxFrame(),n)}}}();return t}),define("pages/pay/cashier/js/validphonecode",[],function(){var e=function(){var e,t=60,a=t,n={lightBoxId:"validator-code-box",title:"手机验证",isBgClickClose:!1,contentHtml:$("#validatorDialogTpl").html()},i=null;return{show:function(o){if(n.closeCallBack=o||function(){},i){var r=$(i.getBoxFrame());r.addClass("light_box"),i.show(),$(".light_box_fullbg").length<=0&&$("body").append('<div class="light_box_fullbg"></div>')}else{i=new MGLightBox(n),i.init();var r=$(i.getBoxFrame());r.off("click"),r.find(".lb_close").off("click").on("click",function(){r.hide(),r.removeClass("light_box"),$(".light_box_fullbg").hide()}),r.on("click",".J-send-validator-code",function(){var e=r.find(".J-validator-tips"),t=$.trim($(".J-validator-code").val());return e.hide(),""===t?void e.html("验证码不能为空").show():void $.ajax({url:"/trade/mgjpay/overageSmsVery",data:{verycode:t},type:"POST",dataType:"json"}).done(function(a){a&&a.status&&1001===a.status.code?($("#J_verycode_v").remove(),$("#J_cashierForm").append('<input type="hidden" name="verycode" id="J_verycode_v" value="'+t+'">'),i.close(),$(".light_box_fullbg").remove(),o&&o(!0)):e.html(a.result||a.status.msg).show()})}),r.on("click",".J-get-validator-code",function(){var n=this,i=$(n);if(n.title||(n.title=n.defaultValue),!e){var o=r.find(".J-validator-tips");o.hide(),i.addClass("deny"),$.ajax({url:"/trade/mgjpay/overageSendSms",data:null,type:"POST",dataType:"json"}).done(function(r){r&&r.status&&1001===r.status.code?(n.value="发送成功",i.addClass("success"),e=setInterval(function(){n.value=a+" 秒后重发",a--,0>a&&(clearInterval(e),a=t,e=void 0,i.removeClass("deny success"),n.value=n.title)},1e3)):o.html(r.result||r.status.msg).show()})}}),$(".J-get-validator-code").trigger("click")}}}}();return e}),define("pages/pay/cashier/js/banklist",[],function(){var e=$("#modou_max"),t=$("#use_modou_num"),a=$("#J_useover"),n={pop:function(e,t,a,n){i.show(e,function(i){if(i){delete e[i.k],a&&a.length>0&&a.val(JSON.stringify(e)),i.showtype=i.k.indexOf("_q_")>=0?"快捷支付":"网上银行";var o=$(MoGu.ui.getTemplate($("#tpl_banklist_item").html(),i));n.prepend(o),setTimeout(function(){o.find("label").eq(0).trigger("click")},0),$(document).trigger("paymethod:change",["banklist"]),MGTOOL.emptyObj(e)&&t.remove()}})},init:function(n){var i=this,n=n||".J_banklist",o=!1,r=$(n);".J_banklist"===n&&(o=!0),r.off("click",".b label").on("click",".b label",function(){var e=$(this);e.parents(".b").find("input").trigger("click")}).off("click",".b input").on("click",".b input",function(){var i=$(this),r=$(n).find(".b"),c=i.parents(".b"),s=c.find("input").attr("value");r.removeClass("b_cur").find("input").removeAttr("checked"),c.addClass("b_cur").find("input").attr("checked","checked"),"string"==typeof s&&("checked"===a.attr("checked")?(e.val(e.attr("data-normal")),t.trigger("modou:reset")):0!==s.indexOf("Q_")||isNaN(e.attr("data-fpay"))?isNaN(e.attr("data-normal"))||(e.val(e.attr("data-normal")),t.trigger("modou:reset")):(e.val(e.attr("data-fpay")),t.trigger("modou:reset"))),o&&$(document).trigger("paymethod:change",["banklist"])}).off("click",".J_more").on("click",".J_more",function(){var e=$(this),t=e.parents(".more_b"),a=t.find(".J_banklist_hidden").eq(0),o=e.parents(n||".J_banklist"),r=JSON.parse(a.val());i.pop(r,t,a,o)})}},i=function(){var e=null,t="lb_bankpop",a="J_popBankList",i=null,o=null,r=function(){var n=$("#"+t);n.off("click",".J_ok").on("click",".J_ok",function(t){t.preventDefault();var r,c=n.find("."+a).find(".b_cur");if(c.length>0){var s=c.find("input").attr("id");i&&i[s]&&(r={k:s,value:i[s].value,icon:i[s].icon},i[s].formname&&(r.formname=i[s].formname),i[s].credit_value&&(r.credit_value=i[s].credit_value))}o&&o(r),e.hide(),e.getBoxFrame().remove()})},c=function(c,s){i=c,o=s;var d,l="";d=$(MoGu.ui.getTemplate($("#tpl_banklist").html(),{bankListClass:a}));for(var u in c){var h=$.extend({},c[u],!0);h.k=u,h.formname+="Pop",l+=MoGu.ui.getTemplate($("#tpl_banklist_item").html(),h)}e=new MGLightBox({lightBoxId:t,title:"选择银行",closeCallBack:s,contentHtml:MoGu.ui.getTemplate($("#tpl_bankPop").html(),{banklist:$("<div>").append(d.html(l)).html()})}),e.init(),n.init("."+a),r()};return{show:function(){c.apply(this,arguments)}}}();return $(document).ready(function(){n.init()}),n}),define("pages/pay/cashier/js/banktab",["pages/pay/cashier/js/banklist"],function(e){var t=function(){var t=$(".J_paytags"),a=$(".J_paybox"),n=function(){t.off("click","li").on("click","li",function(){var e=$(this);e.hasClass("c")||(e.parents(".J_paytags").find(".c").removeClass("c"),e.addClass("c"),a.removeClass("show"),a.eq(e.index()).addClass("show"))})},i=function(){var t=$(".J_BanklistFlist").eq(0),a=$(".J_depositBanklist").eq(0),n=a.find(".J_banklist_hidden").eq(0);$(".J_deposit_more").on("click",function(){var i=$(this),o=JSON.parse(n.val());t.hasClass("m-banklist-line")?e.pop(o,i.parents(".m-pay"),n,t):e.pop(o,i.parents(".m-pay"),n,a)})};return{init:function(){n(),i()}}}();$(document).ready(function(){t.init()})}),define("pages/pay/cashier/js/modou",[],function(){!function(){function e(e){e.css("ime-mode","disabled"),e.bind("keypress",function(e){var t=e.keyCode?e.keyCode:e.which;if($.browser.msie||8!=e.keyCode)return t>=48&&57>=t}),e.bind("keyup",function(){t(e)}),e.bind("blur",function(){t(e)}),e.bind("paste",function(){return!1}),e.bind("dragenter",function(){return!1}),e.on("modou:reset",function(){var t=e.val(),a=0;o=+$("#modou_max").val(),isNaN(t)||(t=+t,a=t>o?o:t),e.val(a),e.trigger("blur"),$("#J_modouable").find("span").html("（可用"+o+"颗）")})}function t(e){/^\d*$/.test(e.val())||""==e.val()?e.attr("old-value",e.val()):e.val(e.attr("old-value")),n();var t=$("#sub_modou_num");""==e.val()?t.val(0):parseInt(e.val(),10)>o?(t.val(0),a("本次交易最多使用蘑豆"+o+"粒")):t.val(parseInt(e.val()));var r=t.val();i.find(".modou_youhui").text((r/100).toFixed(2)),$(document).trigger("modou:change",[r,r/100])}function a(e){i.find(".modou_use_errortip p").text(e),i.find(".modou_use_errortip").addClass("is_error")}function n(){i.find(".modou_use_errortip").removeClass("is_error")}if(0!=$("#modou_max").length&&"false"!=$("#modou_max").val()){var i=($(".use_modou_box"),$(".modou_inputbox")),o=+$("#modou_max").val();$("#use_modou_check").click(function(){$(this).is(":checked")?i.show():(i.hide(),$("#use_modou_num").val(0),$("#sub_modou_num").val(0),$("#use_modou_num").trigger("blur"))}),e($("#use_modou_num"))}}()}),require(["pages/pay/cashier/js/cardno","pages/pay/cashier/js/validphonecode","pages/pay/cashier/js/banktab","pages/pay/cashier/js/modou"],function(e,t){var a=$(document),n=$("#J_cashierForm"),i=$("#J_oldPrice"),o=+i.attr("data-oldprice"),r=+i.attr("data-overage"),c=o,s=r>=o?!0:!1,d=$("#J_useover"),l=$("#J_othPayMethod"),u=$(".J_openOtherPayMethod"),h=$(".J_overageValue"),f=$("#modou_max"),p=$("#use_modou_num"),m=function(){var m=function(){var e=$(".b_cur").eq(0).parents(".J_paybox"),t=$("#J_paytag");t.val(e.length<=0?1:e.attr("data-tag"))},v=function(e){var t=$(".J_banklist").find("input:checked").eq(0),a=t.attr("value"),n=t.attr("data-cvalue");if(t.length<=0)return!1;if(0===a.indexOf("Q_")){if(e===!0)return!0;if(n)return!0}return!1},_=function(){return"checked"===d.attr("checked")?!0:!1},g=function(){var e=f.val();e=isNaN(e)?0:+e;var t=p.val();return t=isNaN(t)?0:+t,t>e?(MOGU.alert("您本次交易最多使用蘑豆"+e+"粒"),!1):v(!0)&&.1>c?(MOGU.alert("快捷支付暂不支持小于0.1元的订单"),!1):c>r&&_()&&$(".J_banklist").find("input:checked").length<=0?(MOGU.alert("您的账户余额不足，请选择其它支付方式支付剩余部分"),!1):_()&&v(!0)&&.1>(100*c-100*r)/100?(MOGU.alert("快捷支付暂不支持小于0.1元的订单，请选择其它支付方式支付剩余部分"),!1):$(".J_banklist").find("input:checked").eq(0).length<=0&&!_()?(MOGU.alert("请选择支付方式"),!1):(m(),!0)},k=function(){$(".b_cur").removeClass("b_cur"),$(".J_banklist").find("input:checked").eq(0).trigger("click"),d.parent().hasClass("is-checked")&&d.attr("checked","checked"),d.filter("input:checked").parent().addClass("is-checked")},b=function(){d.off("click").on("click",function(e){var t=d.parent();return t.hasClass("s-disable")?void e.preventDefault():(_()?(d.parent().addClass("is-checked"),f.val(f.attr("data-normal"))):(d.parent().removeClass("is-checked"),f.val(v(!0)?f.attr("data-fpay"):f.attr("data-normal"))),void p.trigger("modou:reset"))}),u.off("click").on("click",function(){l.removeClass("s-oth-paymethod-hide")}),n.on("click",".J_Submit",function(a){if(a.preventDefault(),g())if(v()){var i=$(".b_cur").find(".posr").find("img").attr("src");e.show(i,function(e){e===!0&&(_()?t.show(function(e){e===!0&&($("input[name=hiddenbanks]").remove(),n.submit())}):($("input[name=hiddenbanks]").remove(),n.submit()))})}else _()?t.show(function(e){e===!0&&($("input[name=hiddenbanks]").remove(),n.submit())}):($("input[name=hiddenbanks]").remove(),n.submit())}),a.on("modou:change",function(e,t,n){c=o-n,i.html(c.toFixed(2)),a.trigger("paymethod:change")}).on("paymethod:change",function(e,t){var a=$(".J_banklist");s=r>=c?!0:!1,s?(_()&&("banklist"===t?d.removeAttr("checked").parent().removeClass("is-checked"):a.find(".b").removeClass("b_cur").find("input").removeAttr("checked")),h.html(c.toFixed(2))):(_()&&a.find(".b_cur").length<=0&&a.find(".b").eq(0).addClass("b_cur").find("input").attr("checked","checked"),h.html(r.toFixed(2)))}),a.trigger("paymethod:change")};return{init:function(){k(),b()}}}();$(document).ready(function(){m.init()})}),define("pages/pay/cashier/pkg-cashier",function(){});