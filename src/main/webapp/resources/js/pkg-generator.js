define("widgets/mtip/index",[],function(){function t(t,e,a){this.message=t,this.targetEl=e,this.settings=$.extend({offsetX:0,offsetY:0,angMethod:"default",angOffset:0,angSpace:7,zIndex:"auto",tipWidth:-1,maxTipWidth:365,direction:"auto",hover:!1,closeBtn:!0},a)}return window.MOGU=MOGU||{},t.prototype.getPositionInfo=function(){var t,e,a={},i=0,s=this._$tip,r=this.targetEl;switch(e=r.offset(),a.targetX=e.left,a.targetY=e.top,a.targetWidth=r.outerWidth(),a.targetHeight=r.outerHeight(),t=s.outerWidth()-s.width(),this.settings.tipWidth>0?s.css("width",this.settings.tipWidth-t):s.outerWidth()>=this.settings.maxTipWidth?s.css("width",this.settings.maxTipWidth-t):s.css("width","auto"),a.tipWidth=s.outerWidth(),a.tipHeight=s.outerHeight(),a.angSpace=this.settings.angSpace,a.angDirection=this.settings.direction,a.angOffset=this.settings.angOffset,a.offsetX=this.settings.offsetX,a.offsetY=this.settings.offsetY,"auto"===a.angDirection&&(a.angDirection=a.targetY-$(window).scrollTop()>=a.tipHeight+a.angSpace-a.offsetY?"top":$(window).scrollTop()+document.body.clientHeight-a.targetY-a.targetHeight>=a.tipHeight+a.angSpace+a.offsetY?"bottom":a.targetX>a.tipWidth+a.angSpace-a.offsetX?"left":document.body.clientWidth-a.targetX-a.targetWidth>=a.tipWidth+a.angSpace+a.offsetX?"right":"top"),a.tipHolderX=0,a.tipHolderY=0,a.angDirection){case"top":a.tipHolderY=-(a.tipHeight+a.angSpace);break;case"bottom":a.tipHolderY=a.targetHeight+a.angSpace;break;case"left":a.tipHolderX=-(a.tipWidth+a.angSpace);break;case"right":a.tipHolderX=a.targetWidth+a.angSpace}if(a.angMethod=this.settings.angMethod,"none"===a.angMethod)a.angStyle={display:"none"};else switch("center"===a.angMethod&&(("top"===a.angDirection||"bottom"===a.angDirection)&&(i=a.tipWidth/2-a.angSpace),("left"===a.angDirection||"right"===a.angDirection)&&(i=a.tipHeight/2-a.angSpace)),a.angDirection){case"top":a.angStyle={display:"block",bottom:0,top:"auto"},a.angOffset>=0?(a.angStyle.left=a.angOffset+i,a.angStyle.right="auto"):(a.angStyle.left="auto",a.angStyle.right=-a.angOffset+i),a.angHolderX=i,a.angHolderY=0;break;case"bottom":a.angStyle={display:"block",top:0,bottom:"auto"},a.angOffset>=0?(a.angStyle.left=a.angOffset+i,a.angStyle.right="auto"):(a.angStyle.left="auto",a.angStyle.right=-a.angOffset+i),a.angHolderX=i,a.angHolderY=0;break;case"left":a.angStyle={display:"block",right:0,left:"auto"},a.angOffset>=0?(a.angStyle.top=a.angOffset+i,a.angStyle.bottom="auto"):(a.angStyle.top="auto",a.angStyle.bottom=-a.angOffset+i),a.angHolderX=0,a.angHolderY=i;break;case"right":a.angStyle={display:"block",left:0,right:"auto"},a.angOffset>=0?(a.angStyle.top=a.angOffset+i,a.angStyle.bottom="auto"):(a.angStyle.top="auto",a.angStyle.bottom=-a.angOffset+i),a.angHolderX=0,a.angHolderY=i}return a.zIndex=this.settings.zIndex,a},t.prototype.show=function(){var t=this._$tip,e=(this.targetEl,this.getPositionInfo());t.removeClass("mtip_top").removeClass("mtip_left").removeClass("mtip_right").removeClass("mtip_bottom").addClass("mtip_"+e.angDirection),t.css({left:e.targetX+e.tipHolderX+e.offsetX-e.angHolderX,top:e.targetY+e.tipHolderY+e.offsetY-e.angHolderY,"z-index":e.zIndex}),t.find(".widget_mtip_a").css(e.angStyle)},t.prototype.render=function(){$("body").append(this._$tip)},t.prototype.bind=function(){var t=this,e=t._$tip,a=t.settings,i=t.targetEl;e.off("click",".widget_mtip_close"),i.off("mouseenter.mtip").off("mouseleave.mtip"),a.closeBtn?e.on("click",".widget_mtip_close",function(){t.close()}):e.find(".widget_mtip_close").hide(),a.hover&&(i.on("mouseenter.mtip",function(){clearTimeout(t.hover_t),t.hover_t=setTimeout(function(){e.show(),t.show()},100)}).on("mouseleave.mtip",function(){clearTimeout(t.hover_t),t.close()}),t.close())},t.prototype.close=function(){this._$tip.hide()},t.prototype.getDom=function(t){var e=$(['<div class="widget_mtip_box">','<div class="widget_mtip_line">'+t+"</div>",'<i class="widget_mtip_ang widget_mtip_a"></i>','<i class="widget_mtip_shadow widget_mtip_a"></i>','<a href="javascript:;" class="widget_mtip_close">×</a>',"</div>"].join(""));return e},MOGU.mtip=function(e,a,i){if(!(a.length<=0)){var s=a.data("mtipObj");return s?(s.message=e,s.settings=$.extend(s.settings,i),s._$tip.find(".widget_mtip_line").html(s.message),s._$tip.show()):(s=new t(e,a,i),a.data("mtipObj",s),s._$tip=s.getDom(s.message),s.render()),s.show(),s.bind(),s}},MOGU.mtip}),define("widgets/address/index",[],function(){return window.MOGU=MOGU||{},MOGU.alert=MOGU.alert||function(t){alert(t)},function(t){function e(t,e,a){this.init(t,e,a)}var a=null,i=['<div class="__addressPop">','<dl class="address_pop">','<input type="hidden" class="J_addressid" name="addressId" value="" />',"<dt>省：</dt>",'<dd class="pt_ie6hack">','<i class="needicon">*</i>','<select name="province" class="J_province J_select w140 vm"> </select>','<label class="dt" for="">市：</label>','<select name="city" class="J_city J_select w100 vm"> </select>','<label class="dt" for="">区：</label>','<select name="area" class="J_area J_select w100 vm"> </select>','<span class="prompt"></span>',"</dd>","<dt>邮政编码：</dt>","<dd>",'<i class="needicon">*</i>','<input type="text" data-type="c" data-errormsg="请填写正确的邮政编码" data-normal="" class="text formsize_normal J_postcode J_form vm" name="postcode">','<span class="prompt"></span>',"</dd>","<dt>街道地址：</dt>","<dd>",'<i class="needicon">*</i>','<textarea data-type="*" data-min="5" data-max="100" data-normal="请填写街道地址，最少5个字，最多不能超过100个字" data-errormsg="请填写街道地址，最少5个字，最多不能超过100个字" class="textarea formsize_large J_street J_form" name="street" cols="30" rows="3"></textarea>','<span class="prompt breakline">请填写街道地址，最少5个字，最多不能超过100个字</span>',"</dd>","<dt>收货人姓名：</dt>","<dd>",'<i class="needicon">*</i>','<input type="text" data-type="*" data-errormsg="请填写收货人" data-normal="" class="text formsize_normal J_name J_form vm" name="name">','<span class="prompt"></span>',"</dd>","<dt>手机：</dt>","<dd>",'<i class="needicon">*</i>','<input type="text" data-type="phone" data-errormsg="请填写正确的联系号码" data-normal="" class="text formsize_normal J_mobile J_form vm" name="mobile">','<span class="prompt"></span>',"</dd>","<dt></dt>",'<dd class="pt10 oper_btn">','<a href="javascript:;" class="confirm_btn J_okbtn mr10">确认地址</a>','<a href="javascript:;" class="cancel_btn J_cancelbtn">取消</a>',"</dd>","</dl>","</div>"].join(""),s=['{{if (it.def === "def") { }}','<option value="{{=it.id}}" {{ if (it.index === 0) { }} selected="selected" {{ } }}>{{=it.name}}</option>',"{{ } else { }}",'<option value="{{=it.id}}" {{ if (it.name === it.def) { }} selected="selected" {{ } }}>{{=it.name}}</option>',"{{ } }}"].join(""),r=["postcode","street","name","mobile","addressId"],n=function(t){return"string"!=typeof t?t:t.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},d=function(t){for(var e in t)t[e]=n(t[e]);return t};e.prototype.init=function(e,a,s){this.box=e,this.$pop=t(i),this.box.append(this.$pop),this.$forms={},this.$forms.province=this.$pop.find(".J_province").eq(0),this.$forms.city=this.$pop.find(".J_city").eq(0),this.$forms.area=this.$pop.find(".J_area").eq(0),this.$forms.postcode=this.$pop.find(".J_postcode").eq(0),this.$forms.street=this.$pop.find(".J_street").eq(0),this.$forms.name=this.$pop.find(".J_name").eq(0),this.$forms.mobile=this.$pop.find(".J_mobile").eq(0),this.$forms.addressId=this.$pop.find(".J_addressid").eq(0),this.option={inter:"/trade/address/addfororder"},this.set(a,s),this.initEvent()},e.prototype.set=function(e,a){a=a||{},this.option=t.extend(this.option,a),delete this.option.address,a.address=a.address||null,this.address=t.extend({postcode:"",street:"",name:"",mobile:"",addressId:"",province:"",city:"",area:""},a.address),"function"==typeof e&&(this.callback=e),this.address.province&&this.address.city&&this.address.area?this.resetAreaSelect(this.address.province,this.address.city,this.address.area):this.resetAreaSelect();for(var i=function(t,e){t.removeClass("error").val(e),t.next().removeClass("notice").html(t.attr("data-normal"))},s=0,n=r.length;n>s;s++)i(this.$forms[r[s]],this.address[r[s]])},e.prototype.show=function(){this.box.show()},e.prototype.updateAddressSelect=function(e,a,i,r,n){var d={};d.level=a,i&&(d.parentId=i),t.ajax({url:"/trade/address/getaddrmap",data:d,type:"GET",dataType:"json",success:function(t){if(t&&t.status&&1001===t.status.code){for(var a=t.result,i=[],d=0,o=a.length;o>d;d++){var c={index:d,id:a[d].id,name:a[d].placeZh,def:r||"def"};i.push(MoGu.ui.getTemplate(s,c))}e.html(i.join("")),"function"==typeof n&&n()}else MOGU.alert(t&&t.status?t.status.msg:"网络错误，请稍后再试")}})},e.prototype.resetAreaSelect=function(t,e,a){var i=this;i.updateAddressSelect(i.$forms.province,1,null,t,function(){i.$forms.province.trigger("change",[e,a])})},e.prototype.initEvent=function(){var e=this;e.$pop.find(".J_form").on("blur",function(){var e,a=t(this),i=a.next(),s=null,r=1,n=a.attr("data-type"),d=t.trim(a.val()),o=a.attr("data-errormsg"),c=a.attr("data-normal"),l=!0;switch(n){case"c":(isNaN(d)||6!==d.length)&&(l=!1);break;case"*":e=a.attr("data-min"),e&&(r=+e),e=a.attr("data-max"),e&&(s=+e),(d.length<r||s&&d.length>s)&&(l=!1);break;case"phone":l=!1,/^1[3|4|5|7|8][0-9]\d{8}$/.test(d)&&(l=!0)}l?(i.removeClass("notice").html(c),a.removeClass("error")):(i.addClass("notice").html(o),a.addClass("error"))}),e.$pop.on("click",".J_okbtn",function(a){a.preventDefault();var i={},s=t(this);if(!s.hasClass("disable")&&(e.$pop.find(".J_form").trigger("blur"),e.$pop.find(".error").length<=0)){s.addClass("disable");for(var r in e.$forms){var n=e.$forms[r];("addressId"!==n.attr("name")||""!==n.val())&&(i[n.attr("name")]=n.val())}t.ajax({url:"/trade/address/getoken",data:null,type:"POST",dataType:"json",success:function(a){a&&a.status&&1001===a.status.code?(i.tn=a.result.tn,i.tv=a.result.tv,t.ajax({url:e.option.inter,data:i,type:"POST",dataType:"json",success:function(a){a&&a.status&&1001===a.status.code?(i.addressId=a.result.addressId,e.$pop.find(".J_select").each(function(){var e=t(this),a=e.attr("name");i[a]=e.find("option").filter(":selected").html()}),i=d(i),e.box.hide(),e.callback&&e.callback(i)):MOGU.alert(a&&a.status?a.status.msg:"网络错误，请稍后再试")},complete:function(){s.removeClass("disable")}})):MOGU.alert("登录信息错误，请刷新页面重试")}})}}),e.$pop.find(".lb_close").off("click"),e.$pop.on("click",".lb_close",function(t){t.preventDefault(),e.box.hide()}),e.$pop.on("click",".J_cancelbtn",function(t){t.preventDefault(),e.box.hide()}),e.$forms.province.on("change",function(a,i,s){var r=t(this).val();e.$forms.city.trigger("update",[r,i,s])}),e.$forms.city.on("change",function(a,i){var s=t(this).val();e.$forms.area.trigger("update",[s,i])}).on("update",function(a,i,s,r){var n=t(this);e.updateAddressSelect(n,2,i,s,function(){n.trigger("change",r)})}),e.$forms.area.on("update",function(a,i,s){e.updateAddressSelect(t(this),3,i,s)})};var o=function(t,i,s){!t||t.length<=0||(a=t.data("_obj_editaddress"),a?a.set(i,s):(a=new e(t,i,s),t.data("_obj_editaddress",a)),a.show())};MOGU.editAddressBox=o}(jQuery),MOGU.editAddressBox}),define("pages/pay/common/js/common",[],function(){return window.webapp=window.webapp||{},webapp.cartCommon=function(t){var e=function(t){return t.substr(0,t.indexOf("_100x100"))+"_280x999.jpg"},a=function(){function e(e,a){var i=this;i.min=1,i.max=+e.attr("data-stocknum"),i.max<i.min&&(i.max=i.min),i.$dom=e,i.$input=e.find(".cart_num_input").eq(0),i.$increase=e.find(".cart_num_add").eq(0),i.$reduce=e.find(".cart_num_reduce").eq(0),i.$cartPaybar=t("#cartPaybar"),i.$disScreen=a,i.stockid=e.attr("data-stockid"),i.num=i.$input.length>0?+i.$input.val():0,i.unit=+a.attr("data-unit"),i.updatePrice(!0),i.num>=i.max&&i.$increase.addClass("disable"),i.num<=1&&i.$reduce.addClass("disable"),i.$increase.on("click",function(){i.judgeNum(i.num+1)}),i.$reduce.on("click",function(){i.judgeNum(i.num-1)}),i.$input.on("blur",function(){var e=t(this),a=e.val();isNaN(a)?i.$input.val(i.num):i.judgeNum(+a)})}e.prototype.judgeNum=function(t){var e=this;(t>e.max||t<e.min)&&e.$input.val(e.num),t>e.num&&t<=e.max&&(!(t<e.max)&&e.$increase.addClass("disable"),e.$reduce.removeClass("disable"),e.$input.val(t),e.num=t,e.updatePrice()),t<e.num&&t>=e.min&&(!(t>e.min)&&e.$reduce.addClass("disable"),e.$increase.removeClass("disable"),e.$input.val(t),e.num=t,e.updatePrice())},e.prototype.updatePrice=function(t){var e=this;e.price=(e.num*e.unit).toFixed(2),e.$disScreen.html(e.price),e.$disScreen.attr("data-price",e.price),e.$cartPaybar.trigger("change:price"),t||e.$dom.trigger("post:change",[e.stockid,e.num])},t(".cart_counter").each(function(){var a=t(this),i=a.parent().next().find(".item_sum").eq(0);new e(a,i)})},i=function(){var a=t(".cartImgTip"),i=['<div class="cart_imgtip_wrap">','<img src="{{=it.src}}" width="240" />',"</div>"].join("");a.each(function(){var a=t(this),s=MoGu.ui.getdoT(),r=s.template(i)({src:e(a.attr("src"))});MOGU.mtip(r,a,{hover:!0,offsetY:-32,angOffset:42,closeBtn:!1,direction:"right"})})},s=function(){var e=t("#cartPaybar:visible"),a=t("#cartOrderTable"),i=e.find(".goodsSum"),s=e.find(".goodsNum"),r=t(window),n=t(".cart_wrap").eq(0),d=e.outerHeight(),o="cart_paybar_fixed";e.length<=0||(e.on("change:price",function(){var r=a.find(".cart_mitem").filter(":not(.s-undo)").find(".cart_thcheck").filter(".checked"),n=0,d=r.length;r.each(function(){var e,a,i,s,r,d=t(this).parent().parent();e=d.attr("data-bid"),a=d.attr("data-stockid"),i=+d.find(".cart_num_input").eq(0).val(),s=+d.find(".cart_data_sprice").attr("data-price"),r=+d.find(".item_sum").attr("data-price"),n+=r}),s.html(d),i.html("¥ "+n.toFixed(2)),0>=d?e.find(".cart_paybtn").addClass("cart_paybtn_disable"):e.find(".cart_paybtn").removeClass("cart_paybtn_disable")}).trigger("change:price"),r.on("scroll.paybar",function(){var t=document.body.scrollTop||document.documentElement.scrollTop||window.pageYOffset||0,a=window.innerHeight||document.documentElement.clientHeight,i=n.offset().top+n.outerHeight()+d-a;t>i?e.removeClass(o):e.addClass(o)}).trigger("scroll.paybar"))},r=function(){t(".cart_hidetip").each(function(){var e=t(this),a=e.next().html();MOGU.mtip(a,e,{hover:!0,angOffset:-20,closeBtn:!1,direction:"bottom"})})},n=function(){var e=t(".cart_table_note");MOGU.Globe_Input_Text_Hide(e),e.trigger("blur")};return{init:function(){i(),r(),n()},initPayBar:function(){s()},initCounter:function(){a()}}}(jQuery),$(document).ready(function(){webapp.cartCommon.init()}),webapp.cartCommon}),define("pages/pay/generator/js/address",[],function(){var t=t||{};t.cartAddress=function(t){var e=t("#cartAddress"),a=(t("#addressCtrl"),t("#J_addAddress")),i=(t(".cart_page_wrap").eq(0),t("#cartAddressList")),s=t("#cartAddressOther"),r=t("#J_otherAddrWrap"),n=t("#addressId"),d=t("#orderForm"),o=t("#J_xm_wrap"),c=t("#J_xmaddress"),l=t("#xmMatched"),p=['<li data-aid="{{=it.addressId}}">','<a href="javascript:;" class="cart_address_card addressCard" data-aid="{{=it.addressId}}">','<h5 class="cart_address_tit">{{=it.name}}</h5>','<p class="cart_address_street">{{=it.street}}</p>','<p class="cart_address_zipinfo" data-postcode="{{=it.postcode}}" data-province="{{=it.province}}" data-city="{{=it.city}}" data-area="{{=it.area}}">{{=it.province}}{{=it.city}}{{=it.area}} {{=it.postcode}}</p>','<p class="cart_address_mobile">{{=it.mobile}}</p>','<i class="cart_address_edit">编辑</i>',"</a>","</li>"].join(""),u=['<li data-storeid="{{=it.xmStoreId}}">','<a href="javascript:;" class="cart_address_card addressXMCard" data-storeid="{{=it.xmStoreId}}">','<h5 class="cart_address_tit">{{=it.person}}</h5>','<p class="cart_address_xmstreet" title="{{=it.addr}}">{{=it.addr}}</p>','<p class="cart_address_zipinfo">{{=it.province}}{{=it.city}}{{=it.area}}</p>','<p class="cart_address_mobile">联系电话: {{=it.phone}}</p>',"</a>","</li>"].join(""),f=function(){var t=i.find(".selected").eq(0);if(t.length>0){var e=t.parent().attr("data-aid");n.val(e)}else MOGU.editAddressBox(r,function(t){m(t)})},h=function(e,a){if(0!=o.length){var i=function(){c.html(""),o.hide(),l.val("")},s=function(e){if(e){var a="";t.each(e,function(t,e){a+=MoGu.ui.getTemplate(u,e)}),c.html(a),o.show(),l.val("true")}};t.ajax({url:"/partner/xiaomai/xiaomaiaddress",data:{addressId:e},type:"POST",dataType:"json",success:function(t){t&&t.status&&1001===t.status.code&&t.result&&t.result.length>0?(s(t.result),a&&a()):(i(),a&&a())},error:function(){i(),a&&a()}})}},m=function(t){var a=i.find(".addressCard").filter("[data-aid="+t.addressId+"]");a.length>0?a.parent().after(MoGu.ui.getTemplate(p,t)).remove():i.prepend(MoGu.ui.getTemplate(p,t));var s=i.find(".addressCard").length;1===s&&i.css("height",i.find("li").eq(0).outerHeight()),s>4&&e.find(".allAddressSwitch").show(),e.find(".addressCard").filter("[data-aid="+t.addressId+"]").trigger("click")},g=function(){var o="cart_address_other_hide";e.on("click",".allAddressSwitch",function(e){e.preventDefault();var a=t(this),s=i.find("li"),r=s.length,n=s.eq(0).outerHeight();a.remove(),i.stop().animate({height:Math.ceil(r/4)*n},500,function(){t(this).css("height","auto")})}),e.on("click",".addOtherAddress",function(){MOGU.editAddressBox(r,function(t){m(t)})}),e.on("click","#J_addAddress",function(){a.hide(),MOGU.editAddressBox(r,function(t){m(t)})}),e.on("click",".J_cancelbtn",function(){i.find("li").length<=0&&a.show()}),i.on("click",".addressCard",function(){var a=t(this);if(a.hasClass("selected"))return void(i.hasClass("s-selectedXm")&&(i.removeClass("s-selectedXm"),e.find(".selected").removeClass("selected"),a.addClass("selected")));i.removeClass("s-selectedXm"),e.find(".selected").removeClass("selected"),a.addClass("selected");var s=a.parent().attr("data-aid");n.val(s),h(s,function(){d.trigger("change:data")})}),c.on("click",".addressXMCard",function(){var e=t(this);e.hasClass("selected")||(c.find(".selected").removeClass("selected"),e.addClass("selected"),i.addClass("s-selectedXm"))}),e.on("mouseenter",".addressCard",function(){t(this).find(".cart_address_edit").show()}).on("mouseleave",".addressCard",function(){t(this).find(".cart_address_edit").hide()}).on("click",".cart_address_edit",function(){var e=t(this).parent();return s.removeClass(o),MOGU.editAddressBox(r,function(t){m(t)},{address:{province:e.find(".cart_address_zipinfo").attr("data-province"),city:e.find(".cart_address_zipinfo").attr("data-city"),area:e.find(".cart_address_zipinfo").attr("data-area"),postcode:e.find(".cart_address_zipinfo").attr("data-postcode"),street:e.find(".cart_address_street").html(),name:e.find(".cart_address_tit").html(),mobile:e.find(".cart_address_mobile").html(),addressId:e.attr("data-aid")}}),!1});var l="小麦公社是大学校区内为学生免费代收包裹的服务站，方便你随时取件，保证包裹安全。",p=t("#J_xmhtip");p.length>0&&MOGU.mtip(l,p,{direction:"bottom",hover:!0,angOffset:70,closeBtn:!1,maxTipWidth:310,offsetX:-70,offsetY:5});var u=e.find(".addressCard").filter(".selected");if(u.length>0){var f=u.attr("data-aid");f&&h(f)}};return{init:function(){f(),g()}}}(jQuery),$(document).ready(function(){t.cartAddress.init()})}),require(["widgets/mtip/index","widgets/address/index","pages/pay/common/js/common","pages/pay/generator/js/address"],function(){var t=MOGU.EasyBuy||{};t.EasyInit=function(e){function a(n){var d="",o="",c=n.val();if("no_alert"==c)return void(e&&e());1==c?(d="手机号码验证",o=i):2==c?(d="选择是否使用全场优惠",o=s):3==c&&(d="手机验证成功",o=r);var l={title:d,lightBoxId:"nologin_binding_alert",contentHtml:o,scroll:!0,isBgClickClose:!1,closeCallBack:function(){(2==c||3==c)&&n.val("no_alert")}},p=new MGLightBox(l);p.init();var u=$("#nologin_binding_alert");if(1==c)u.find(".binding_tel_num").val($("#cartAddressList .cart_address_mobile").eq(0).text()),t.initGetTelCodeBtn($("#binding_get_code")),$("#binding_get_code").trigger("click"),u.on("click",".binding_check_code",function(){var e=$("#binding_check_code");if(!e.hasClass("is_ajax")){var i=$.trim($("#binding_tel_code").val()),s=$.trim($("#binding_tel_num").val());if(""==s)return void alert("请输入手机号码！");if(isNaN(s)||!/^1\d{10,10}$/.test(s))return void alert("请输入正确的手机号码！");if(""==i)return void alert("请输入手机验证码！");e.addClass("is_ajax"),t.checkBindingLogin(s,i,function(){$.post("/trade/generateorder/directAfterLogin",$("#orderForm").serialize(),function(t){if($(".cart_orderbar .eb_hide").removeClass("eb_hide"),"1001"==t.status.code){var e=$.parseJSON(t.result);$("#cashReduce").html(e.proshtml),n.val(2),p.close(),a(n)}else"9002000"==t.status.code&&(n.val(3),p.close(),a(n))},"json")},e)}});else if(2==c){var f=$("#cashReduce"),h=$("#cashReduce_easybuy");h.html(f.html()),u.find(".cart_table_disduce").text($("#cashReduceScreen").text()),u.find(".goods_sum").text($(".cart_paybar .goodsSum").text()),h.on("change",function(){f.get(0).selectedIndex=h.get(0).selectedIndex,f.trigger("change")}),$("#cashReduce_easybuy").trigger("change"),u.find(".sub_easybuy_order").click(function(){e&&e()})}else 3==c&&u.find(".sub_easybuy_order").click(function(){e&&e()})}$.post("/trade/generateorder/saveInfo2Cache",$("#orderForm").serialize());var i=['<div class="nologin_buy_box clearfix">','<p class="binding_tel_title">完成手机验证，即可通过手机号登录蘑菇街，查看订单最新进展！</p>','<div class="binding_input_line clearfix">','<span class="fl">手机：</span>','<input type="text" class="binding_tel_num" id="binding_tel_num" value="" sure-mod="hide">',"</div>",'<div class="binding_input_line clearfix">','<span class="fl">验证码：</span>','<input type="text" class="binding_tel_code fl" id="binding_tel_code" value="">','<a href="javascript:;" class="binding_get_code fl" id="binding_get_code" send-method="nologin" tel-input-id="binding_tel_num" ready-text="获取验证码" wait-text="重新发送">获取验证码</a>',"</div>",'<a href="javascript:;" class="binding_check_code" id="binding_check_code" code_input_id="binding_tel_code"></a>',"</div>"].join(""),s=['<div class="nologin_buy_box easybuy_selected_coupon clearfix">',"<h4>恭喜你验证成功！</h4>",'<div class="select_input_line dash_top clearfix" style="padding-top:34px">','<span class="fl">全场优惠：</span>','<select class="fl" name="" id="cashReduce_easybuy">','<option value="-1" selected="selected">不使用优惠</option>',"</select>",'<p class="cart_table_disduce fl">-¥ 0.00</p>',"</div>",'<div class="select_input_line clearfix">','<span class="fl">订单总计：</span>','<p class="goods_sum fl">¥ 0.00</p>',"</div>",'<a href="javascript:;" class="sub_easybuy_order" id="sub_easybuy_order"></a>',"</div>"].join(""),r=['<div class="nologin_buy_box easybuy_login_succ clearfix">',"<h4>恭喜你验证成功！</h4>",'<a href="javascript:;" class="sub_easybuy_order" id="sub_easybuy_order"></a>',"</div>"].join("");a($("#easy_buy_step"))};var e=e||{};e.order=function(e){var a=e("#orderForm"),i=e("#addressId"),s=e("#postdata"),r=e(".goodsSum"),n=e("#cashReduce"),d=e("#cashReduceScreen"),o=e(".shopSum"),c=e("#J_otherCalcResult"),l=e(".shopPromo"),p=(e(".postage"),e(".itemSum")),u=e(".cartItemPromo"),f=e(".ableXCHF"),h=e(".disableXCHF"),m=e(".cart_surebtn"),g=e("#preSaleStep"),_=e("#preSaleAgree"),v=e("#J_xmaddress"),b=e("#xmStoreId"),y=e("#cartPayMethod"),x=e("#body_wrap"),$=MOGU.listAllPrice,w=function(t){var e,a;f.length>0&&(a=t.finalprice,e=+f.val("data-able"),a>e?(f.hide(),h.show(),m.addClass("cart_surebtn_disable")):(f.show(),h.hide(),m.removeClass("cart_surebtn_disable")))},C=function(t){var a=0;if(r.html("¥ "+t.finalprice),e("#modou_max").length>0&&"false"!=e("#modou_max").val()&&(e("#sub_modou_num").val(t.modou),e("#use_modou_num").val(t.modou),e("#no_modou_price").val(t.finalprice),e("#modou_max").val(t.maxModou),e("#use_modou_num").trigger("blur")),e("#nologinbuytype").length>0&&(e(".easybuy_selected_coupon .cart_table_disduce").text("-¥ "+t.cutprice),e(".easybuy_selected_coupon .goods_sum").text("¥ "+t.finalprice),e("#cashReduce_easybuy").html(t.proshtml)),n.html(t.proshtml),d.html("-"+t.cutprice+"元"),t&&t.otherCalcResult&&t.otherCalcResult.length>0){c.show();for(var i="",s=0,f=t.otherCalcResult.length;f>s;s++)i+="<p><span>"+t.otherCalcResult[s].decorate+'</span>:<span class="pl8">-'+t.otherCalcResult[s].cutPrice+"元</span></p>";c.find("td").eq(0).html(i)}else c.hide(),c.find("td").eq(0).html("");g.length>0&&(g.find(".reserve_pay").eq(0).html(t.preSale.partFirstBuyerPay),g.find(".final_pay").eq(0).html(t.preSale.partLastBuyerPay),g.find(".cu_pay").eq(0).html("¥ "+t.preSale.cuBuyerPay)),e.each(t.shoplists,function(t,i){var s,r;for(s in i)r=i[s],o.eq(t).html("¥ "+r.finalprice),l.filter("[data-groupid="+s+"]").find(".shopPromoSel").eq(0).html(r.proshtml),l.filter("[data-groupid="+s+"]").find(".shopPromoDuce").eq(0).html("- "+r.cutprice),r.stocklists&&e.each(r.stocklists,function(t,e){p.eq(a).html(e.finalprice);var i=u.eq(a).find("select.stockpro").eq(0),s=u.eq(a).find(".J_extraPromo").eq(0);i.length>0&&(i.html(e.proshtml),i.next().html("省"+e.cutprice+"元")),s.html(e.otherproshtml||""),a++})})},S=function(){e(".cart_table_note").each(function(){var t=e(this);t.val()===t.attr("def-v")&&t.val("")});var i=m.eq(0).attr("data-url")||"/trade/order/list4buyer?from=pay",s=e("#nologinbuytype").length>0?!0:!1,r=navigator.userAgent.toLocaleLowerCase().indexOf("ipad")>=0?!0:!1;s?t.EasyInit(function(){r?(a.removeAttr("target"),a.submit()):(a.submit(),setTimeout(function(){location.href=i},500))}):r?(a.removeAttr("target"),a.submit()):(a.submit(),setTimeout(function(){location.href=i},500))},k=function(){x.on("click",".cart_surebtn",function(t){t.preventDefault();var a=e(this);if(!a.hasClass("cart_surebtn_disable")){var s=i.val(),r=e("#virtualAddressId");if(r.length>0&&(s=r.val(),"-2"==s&&i.val(s)),""===s)return void MOGU.alert("请填写收货地址");var n=v.find(".selected");b.val(n.length>0&&""!==n.attr("data-storeid")?n.attr("data-storeid"):"");var d=e.trim(e("#cartAddress").find("li").filter("[data-aid="+s+"]").find(".cart_address_mobile").eq(0).html()),o=function(t){return/^1[0-9][0-9]\d{8}$/.test(t)?!0:0!==t.indexOf("1")&&/^[0-9\-]{10,16}$/.test(t)?!0:!1};return 0!=r.length||o(d)?e("#modou_max").length>0&&"false"!=e("#modou_max").val()&&e(".modou_use_errortip").hasClass("is_error")?void MOGU.alert("您填写的蘑豆数量有误，请修改后重新提交"):void S():void MOGU.alert("您填写的收货地址联系号码有误，请修改后重新提交")}}),a.on("change:data",function(t,a){var r,n={};n.postdata=$,r=a&&a.addressId?a.addressId:i.val(),n.addressId=r;var d=v.find(".selected");d.length>0&&""!==d.attr("data-storeid")&&(n.xmStoreId=d.attr("data-storeid")),n.payMethod=y.find("input").filter(":checked").val(),e.ajax({url:"/trade/generateorder/calcprices",data:{postdata:JSON.stringify(n)},type:"POST",dataType:"json",success:function(t){if(1001===t.status.code){var a=e.parseJSON(t.result);C(a),w(a),$=a,s.val(t.result)}}})}).trigger("change:data"),x.on("change",".stockpro",function(){var t=e(this),i=t.parent(),s=+i.attr("data-itemindex"),r=i.attr("data-groupid"),n=+i.attr("data-shopindex");$.shoplists[n][r].stocklists[s].proid=t.val(),a.trigger("change:data")}),x.on("change",".shopPromoSel",function(){var t=e(this),i=t.parents(".shopPromo"),s=i.attr("data-groupid"),r=+i.attr("data-shopindex");$.shoplists[r][s].proid=t.val(),a.trigger("change:data")}),x.on("change",".postage",function(){var t=e(this),i=t.attr("data-groupid"),s=+t.attr("data-shopindex");$.shoplists[s][i].logistics=t.val(),a.trigger("change:data")}),x.on("change","#cashReduce",function(){var t=e(this);$.proid=t.val(),a.trigger("change:data")}),_.on("click",function(){var t=e(this);t.toggleClass("checked"),t.hasClass("checked")?(m.removeClass("cart_surebtn_reserve_disable"),m.removeClass("cart_surebtn_disable")):(m.addClass("cart_surebtn_reserve_disable"),m.addClass("cart_surebtn_disable"))})};return{init:function(){k()}}}(jQuery),$(document).ready(function(){e.order.init()})});